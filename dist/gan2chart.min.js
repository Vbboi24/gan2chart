!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Gan2Chart=e()}(this,function(){"use strict";!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".gan2 {\n  border: 1px solid #e0e0e0; }\n  .gan2 .bar {\n    fill: white;\n    stroke: #bababa;\n    stroke-width: 0.5px;\n    transition: stroke-width .3s ease;\n    user-select: none;\n    cursor: pointer; }\n    .gan2 .bar .bar-wrapper:nth-of-type(n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group .bar-progress {\n          fill: beige; }\n        .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .bar {\n        fill: #f7f7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .bar-progress {\n        fill: #eaeab4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n).active .bar {\n        fill: #f7f7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n).active .bar-progress {\n        fill: #eaeab4; }\n    .gan2 .bar .bar-wrapper:nth-of-type(2n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group .bar-progress {\n          fill: #e9f5dc; }\n        .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .bar {\n        fill: #eef7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .bar-progress {\n        fill: #d0eab4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n).active .bar {\n        fill: #eef7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n).active .bar-progress {\n        fill: #d0eab4; }\n    .gan2 .bar .bar-wrapper:nth-of-type(3n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group .bar-progress {\n          fill: #e8dcf5; }\n        .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .bar {\n        fill: #ede4f7; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .bar-progress {\n        fill: #ceb4ea; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n).active .bar {\n        fill: #ede4f7; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n).active .bar-progress {\n        fill: #ceb4ea; }\n  .gan2 .grid-background {\n    fill: white; }\n  .gan2 .grid-header {\n    fill: #ffffff;\n    stroke: #e0e0e0;\n    stroke-width: 1.4px; }\n  .gan2 .grid-row {\n    fill: #ffffff; }\n  .gan2 .grid-row:nth-child(even) {\n    fill: #f5f5f5; }\n  .gan2 .row-line {\n    stroke: #ebeff2; }\n  .gan2 .tick {\n    stroke: #e0e0e0;\n    stroke-width: 0.4px; }\n    .gan2 .tick.thick {\n      stroke-width: 0.8px; }\n  .gan2 .today-highlight {\n    fill: #fcf8e3;\n    opacity: 0.5; }\n  .gan2 .saturday-highlight {\n    fill: #deeafc;\n    opacity: 0.25; }\n  .gan2 .sunday-highlight {\n    fill: #fcd9cb;\n    opacity: 0.25; }\n  .gan2 .arrow {\n    fill: none;\n    stroke: #666;\n    stroke-width: 1.4px; }\n  .gan2 .bar-progress {\n    fill: beige;\n    stroke: #bababa;\n    stroke-width: 0.5px; }\n  .gan2 .bar-invalid {\n    fill: transparent;\n    stroke: #8D99A6;\n    stroke-width: 1px;\n    stroke-dasharray: 5; }\n    .gan2 .bar-invalid ~ .bar-label {\n      fill: #555; }\n  .gan2 .bar-label {\n    fill: #fff;\n    dominant-baseline: central;\n    text-anchor: middle;\n    font-size: 12px;\n    font-weight: lighter; }\n  .gan2 .handle {\n    fill: #ddd;\n    cursor: ew-resize;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity .3s ease; }\n  .gan2 .lower-text, .gan2 .upper-text {\n    font-size: 12px;\n    text-anchor: middle; }\n  .gan2 .upper-text {\n    fill: #555; }\n  .gan2 .lower-text {\n    fill: #333; }\n  .gan2 .upper-division-bar {\n    stroke: #d8d8d8;\n    stroke-width: 0.5px; }\n  .gan2 .hide {\n    display: none; }\n  .gan2 .bar-fixed .bar {\n    stroke: #444;\n    stroke-dasharray: 5;\n    animation: dash-animation 2s linear;\n    animation-iteration-count: infinite;\n    animation-direction: alternate; }\n\n@keyframes dash-animation {\n  to {\n    stroke-dashoffset: 50px; } }\n\n.gan2-container {\n  position: relative;\n  overflow: auto;\n  font-size: 12px;\n  display: inline-block;\n  width: auto;\n  max-width: 100%;\n  text-align: left !important; }\n  .gan2-container .popup-wrapper {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background: white;\n    padding: 1px;\n    color: #333;\n    border-radius: 3px;\n    min-width: 100px;\n    opacity: 0;\n    -webkit-box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5);\n    -moz-box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5);\n    box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5); }\n    .gan2-container .popup-wrapper.block-event {\n      pointer-events: none; }\n    .gan2-container .popup-wrapper .title {\n      border-bottom: 2px solid #555;\n      padding: 2px 6px 2px 6px; }\n    .gan2-container .popup-wrapper .date {\n      color: #555;\n      padding: 2px 6px 1px 6px; }\n    .gan2-container .popup-wrapper .content {\n      color: #666;\n      padding: 1px 6px 2px 6px; }\n    .gan2-container .popup-wrapper .pointer {\n      position: absolute;\n      height: 5px;\n      margin: 0 0 0 -5px;\n      border: 5px solid transparent;\n      border-top-color: white; }\n");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(){function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}}(),r=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},g=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function p(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var a in e)"appendTo"===a?e.appendTo.appendChild(n):"innerHTML"===a?n.innerHTML=e.innerHTML:n.setAttribute(a,e[a]);return n}function e(t,e,n,a){var i=function(t,e,n,a){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"0.4s",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"0.1s",o=t.querySelector("animate");if(o)return l.attr(o,{attributeName:e,from:n,to:a,dur:i,begin:"click + "+r}),t;var s=p("animate",{attributeName:e,from:n,to:a,dur:i,begin:r,calcMode:"spline",values:n+";"+a,keyTimes:"0; 1",keySplines:(h="ease-out",{ease:".25 .1 .25 1",linear:"0 0 1 1","ease-in":".42 0 1 1","ease-out":"0 0 .58 1","ease-in-out":".42 0 .58 1"}[h])});var h;return t.appendChild(s),t}(t,e,n,a);if(i===t){var r=document.createEvent("HTMLEvents");r.initEvent("click",!0,!0),r.eventName="click",i.dispatchEvent(r)}}SVGElement.prototype.getX=function(){return+this.getAttribute("x")},SVGElement.prototype.getY=function(){return+this.getAttribute("y")},SVGElement.prototype.getWidth=function(){return+this.getAttribute("width")},SVGElement.prototype.getHeight=function(){return+this.getAttribute("height")},SVGElement.prototype.getEndX=function(){return this.getX()+this.getWidth()};var c,n,l={on:function(t,e,n,a){a?l.delegate(t,e,n,a):(a=n,l.bind(t,e,a))},off:function(t,e,n){t.removeEventListener(e,n)},bind:function(e,t,n){t.split(/\s+/).forEach(function(t){e.addEventListener(t,n)})},delegate:function(t,e,n,a){t.addEventListener(e,function(t){var e=t.target.closest(n);e&&(t.delegatedTarget=e,a.call(this,t,e))})},closest:function(t,e){return e?e.matches(t)?e:l.closest(t,e.parentNode):null},attr:function(t,e,n){if(!n&&"string"==typeof e)return t.getAttribute(e);if("object"!==(void 0===e?"undefined":i(e)))t.setAttribute(e,n);else for(var a in e)l.attr(t,a,e[a])}};(n=c||(c={}))[n.MILLISECOND=0]="MILLISECOND",n[n.SECOND=1]="SECOND",n[n.MINUTE=2]="MINUTE",n[n.HOUR=3]="HOUR",n[n.DAY=4]="DAY",n[n.MONTH=5]="MONTH",n[n.YEAR=6]="YEAR";var o="gan2",s="gan2-container",u="popup-wrapper",d="grid-background",f="grid-row",v="row-line",b="grid-header",y="tick",k="today-highlight",m="saturday-highlight",w="sunday-highlight",x="active",a="handle-group",D="bar",T="bar-label",$="progress",M="bar-progress",C="bar-fixed",_="bar-group",H="bar-wrapper",E="handle",W="upper-text",Y="upper-division-bar",S="lower-text",A={en:["January","February","March","April","May","June","July","August","September","October","November","December"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},P={ko:{year:"년",day:"일",hour:"시"}},B=function(){function l(){h(this,l)}return t(l,null,[{key:"parse",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"-",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:/[.:]/;if(!t)return new Date;if(t instanceof Date)return t;var a=t.split(" "),i=a[0].split(e).map(function(t){return parseInt(t,10)}),r=a[1]&&a[1].split(n);i[1]=i[1]-1,r&&r.length&&(4==r.length&&(r[3]="0."+r[3],r[3]=1e3*parseFloat(r[3])),i=i.concat(r));var o=g(i,6),s=o[0],h=o[1],p=o[2],u=o[3],d=o[4],l=o[5];return new Date(s,h,p,0|u,0|d,0|l)}},{key:"toString",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.getDateValues(t).map(function(t,e){return l.padStart((t=1===e?t+1:t)+"",6===e?3:2,"0")}),a=n[0]+"-"+n[1]+"-"+n[2],i=n[3]+":"+n[4]+":"+n[5]+"."+n[6];return a+(e?" "+i:"")}},{key:"format",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss.SSS",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",a=this.getDateValues(t).map(function(t){return l.padStart(t,2,0)}),i=function(t){return P[n]?P[n][t]:""},r={YYYY:a[0],MM:l.padStart(+a[1]+1,2,0),DD:a[2],HH:a[3],mm:a[4],ss:a[5],SSS:a[6],D:a[2],MMMM:A[n][+a[1]],MMM:A[n][+a[1]],DDDD:[+a[2]]+i("day"),HHHH:[+a[3]]+i("hour"),YYYYYYYY:[+a[0]+i("year")]},o=e,s=[];return Object.keys(r).sort(function(t,e){return e.length-t.length}).forEach(function(t){o.includes(t)&&(o=o.replace(t,"$"+s.length),s.push(r[t]))}),s.forEach(function(t,e){o=o.replace("$"+e,t)}),o}},{key:"diff",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:c.DAY,a=[t,e].map(function(t){return l.parse(t)}).map(function(t){return t.getTime()}).sort(function(t,e){return e-t}),i=g(a,2),r=i[0]-i[1],o=r/1e3,s=o/60,h=s/60,p=h/24,u=p/30,d=[r,o,s,h,p,u,u/12];return Math.floor(d[n])}},{key:"today",value:function(){var t=this.getDateValues().slice(0,3),e=g(t,3),n=e[0],a=e[1],i=e[2];return new Date(n,a,i)}},{key:"now",value:function(){return new Date}},{key:"add",value:function(t,e,n){var a;return new Date(t.getFullYear()+(n===c.YEAR?e:0),t.getMonth()+(n===c.MONTH?e:0),t.getDate()+(a=e,n===c.DAY?a:0),t.getHours()+(n===c.HOUR?e:0),t.getMinutes()+(n===c.MINUTE?e:0),t.getSeconds()+(n===c.SECOND?e:0),t.getMilliseconds()+(n===c.MILLISECOND?e:0))}},{key:"startOf",value:function(t,e){var n,a=(r(n={},c.YEAR,6),r(n,c.MONTH,5),r(n,c.DAY,4),r(n,c.HOUR,3),r(n,c.MINUTE,2),r(n,c.SECOND,1),r(n,c.MILLISECOND,0),n),i=function(t){return a[t]<=a[e]};return new Date(t.getFullYear(),i(c.YEAR)?0:t.getMonth(),i(c.MONTH)?1:t.getDate(),i(c.DAY)?0:t.getHours(),i(c.HOUR)?0:t.getMinutes(),i(c.MINUTE)?0:t.getSeconds(),i(c.SECOND)?0:t.getMilliseconds())}},{key:"clone",value:function(t){return new Date(t)}},{key:"getDateValues",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Date;return[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]}},{key:"getDateLabel",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",a=!!P[n],i="",r="",o=a?"YYYYYYYY":"YYYY",s=a?"HHHH":"HH",h=a?"DDDD":"D",p=a?"MMMM":"MMM",u=a?"MMM "+h:h+" MMM";switch(e){case c.YEAR:i=l.format(t,""+o,n);break;case c.MONTH:r=t.getFullYear()?l.format(t,""+o,n):"",i=l.format(t,""+p,n);break;case c.HOUR:r=t.getDate()?l.format(t,""+u,n):"",i=l.format(t,""+s,n);break;default:r=t.getMonth()||0===t.getMonth()?l.format(t,"MMMM",n):"",i=l.format(t,""+h,n)}return{lower:i,upper:r}}},{key:"padStart",value:function(t,e,n){return t+="",e>>=0,n=String(void 0!==n?n:" "),t.length>e?String(t):((e-=t.length)>n.length&&(n+=n.repeat(e/n.length)),n.slice(0,e)+String(t))}}]),l}(),L=function(){function a(t,e,n){h(this,a),this.gantt=t,this.fromTask=e,this.toTask=n,this.calculatePath(),this.create()}return t(a,[{key:"calculatePath",value:function(){var t=this.gantt.option,e=t.arrowCurve,n=t.headerHeight,a=t.barHeight,i=t.padding,r=[this.fromTask.taskBar,this.toTask.taskBar],o=r[0],s=r[1],h=s.$bar.getX()-20;h<o.$bar.getX()+20?h=o.$bar.getX()+20:h>o.$bar.getX()+o.$bar.getWidth()-20&&(h=o.$bar.getX()+o.$bar.getWidth()-20);var p=n+a+(i+a)*this.fromTask.index+i,u=s.$bar.getX()-i/2,d=n+a/2+(i+a)*this.toTask.index+i,l=this.fromTask.index>this.toTask.index,g=l?1:0,c=l?-e:e,f=d+(l?+e:-e);if(this.path="M "+h+" "+p+"\n                 V "+f+"\n                 a "+e+" "+e+" 0 0 "+g+" "+e+" "+c+"\n                 L "+u+" "+d+"\n                 m -5 -5\n                 l 5 5\n                 l -5 5",s.$bar.getX()<=o.$bar.getX()+i){var v=i/2-e,b=s.$bar.getY()+s.height/2-c,y=s.$bar.getX()-i;this.path="M "+h+" "+p+"\n                   v "+v+"\n                   a "+e+" "+e+" 0 0 1 -"+e+" "+e+"\n                   H "+y+"\n                   a "+e+" "+e+" 0 0 "+g+" -"+e+" "+c+"\n                   V "+b+"\n                   a "+e+" "+e+" 0 0 "+g+" "+e+" "+c+"\n                   L "+u+" "+d+"\n                   m -5 -5\n                   l 5 5\n                   l -5 5"}}},{key:"create",value:function(){this.$element=p("path",{d:this.path,class:this.toTask.customArrowClass,"data-from":this.fromTask.id,"data-to":this.toTask.id})}},{key:"update",value:function(){this.calculatePath(),this.$element.setAttribute("d",this.path)}}]),a}(),O=function(){function s(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:c.DAY,a=this,i=arguments[3],r=arguments[4];if(h(this,s),this.gan2Chart=e,this._task=t,this.id=r?r.toString():s.generateId(t),this.name=t.name,this.startDate=B.parse(t.startDate),this.endDate=B.parse(t.endDate),this.progress=t.progress,this.progressFixed=t.progressFixed,this.customArrowClass=t.customArrowClass,this.customClass=t.customClass,this.fixed=t.fixed,e.option.ignoreIndex||void 0===t.index||null===t.index?this.index=e._gan2TaskIndex++:this.index=t.index,this.parentTask=i,this.childTask=[],this._arrows=[],t.startDate||t.endDate)this.startDate=B.parse(this.startDate)||B.add(this.endDate,-2,n),this.endDate=B.parse(this.endDate)||B.add(this.startDate,2,n);else{var o=B.today();this.startDate=o,this.endDate=B.add(o,2,n)}B.getDateValues(this.endDate).slice(3).every(function(t){return 0===t})&&(this.endDate=B.add(this.endDate,24,c.HOUR)),t.childTask&&(this.childTask=t.childTask.map(function(t){return new s(e,t,n,a)}))}return t(s,[{key:"_drawArrow",value:function(t){var n=this;if(this._arrows=[].concat(this.childTask.reduce(function(t,e){return t.concat(e._drawArrow(n.id))},[])),t){var e=new L(this.gan2Chart,this.parentTask,this);this.gan2Chart._layers.arrow.appendChild(e.$element),this._arrows.push(e)}return this._arrows}},{key:"getAllChildTaskWithThis",get:function(){return this.childTask.reduce(function(t,e){return t.concat(e.getAllChildTaskWithThis)},[]).concat(this)}},{key:"length",get:function(){return this.childTask.reduce(function(t,e){return t+1},0)+1}}],[{key:"generateId",value:function(t){return t.name+"_"+Math.random().toString(36).slice(2,12)}}]),s}(),X=function(){function n(t,e){h(this,n),this.gan2Chart=t,this.task=e,this.fixed=e.fixed,this.progressfixed=e.progressFixed,this.prepareValues(),this.draw(),this.bindPopupEvent()}return t(n,[{key:"prepareValues",value:function(){this.duration=B.diff(this.task.endDate,this.task.startDate,this.gan2Chart._viewMode-1)/this.gan2Chart.option.step,this.width=this.gan2Chart.option.columnWidth*this.duration,this.height=this.gan2Chart.option.barHeight,this.x=this.computeX,this.y=this.computeY,this.cornerRadius=this.gan2Chart.option.barCornerRadius,this.progressWidth=this.gan2Chart.option.columnWidth*this.duration*(this.task.progress/100)||0,this.$group=p("g",{class:H+" "+(this.task.customClass||""),"data-id":this.task.id}),this.$barGroup=p("g",{class:""+_,appendTo:this.$group}),this.$handleGroup=p("g",{class:""+a,appendTo:this.$group})}},{key:"draw",value:function(){this.drawBar(),this.drawProgressBar(),this.drawLabel(),this.drawResizeHandles()}},{key:"drawBar",value:function(){this.$bar=p("rect",{x:this.x,y:this.y,width:this.width,height:this.height,rx:this.cornerRadius,ry:this.cornerRadius,class:""+D,appendTo:this.$barGroup}),e(this.$bar,"width",0,this.width),this.fixed&&this.$barGroup.classList.add(""+C)}},{key:"drawProgressBar",value:function(){this.$progressBar=p("rect",{x:this.x,y:this.y,width:this.progressWidth,height:this.height,rx:this.cornerRadius,ry:this.cornerRadius,class:""+M,appendTo:this.$barGroup}),e(this.$progressBar,"width",0,this.progressWidth)}},{key:"drawLabel",value:function(){var t=this;p("text",{x:this.x+this.width/2,y:this.y+this.height/2,innerHTML:this.task.name,class:""+T,appendTo:this.$barGroup}),requestAnimationFrame(function(){return t.updateLabelPosition()})}},{key:"drawResizeHandles",value:function(){if(!this.fixed){var t=this.$bar;p("rect",{x:t.getX()+t.getWidth()-9,y:t.getY()+1,width:8,height:this.height-2,rx:this.cornerRadius,ry:this.cornerRadius,class:E+" right",appendTo:this.$handleGroup}),p("rect",{x:t.getX()+1,y:t.getY()+1,width:8,height:this.height-2,rx:this.cornerRadius,ry:this.cornerRadius,class:E+" left",appendTo:this.$handleGroup}),this.task.progress&&this.task.progress<100&&!this.progressfixed&&(this.$handleProgress=p("polygon",{points:this.getProgressPolygonPoints(),class:E+" "+$,appendTo:this.$handleGroup}))}}},{key:"getProgressPolygonPoints",value:function(){var t=this.$progressBar;return[t.getEndX()-5,t.getY()+t.getHeight(),t.getEndX()+5,t.getY()+t.getHeight(),t.getEndX(),t.getY()+t.getHeight()-8.66].toString()}},{key:"bindPopupEvent",value:function(){var e=this,n=this.gan2Chart.option.popupTrigger;n.includes("click")&&(l.on(this.$group,"mousedown",function(t){return e.gan2Chart._$popupWrapper.classList.add("block-event")}),l.on(this.$group,"mouseup",function(t){return e.gan2Chart._$popupWrapper.classList.remove("block-event")})),l.on(this.$group,"focus "+n,function(t){e.gan2Chart._draggingBar||(e.gan2Chart._draggingBar||t.type!==n||e.gan2Chart._showPopup(t,e.task),e.gan2Chart._unSelectAll(),e.$group.classList.toggle("."+x))}),n.includes("mouse")&&(this.gan2Chart._$popupWrapper.classList.add("block-event"),l.on(this.$group,"mouseleave",function(t){return e.gan2Chart._hidePopup(t)}))}},{key:"isUpdatableX",value:function(t){return!this.task.parentTask||this.task.parentTask.taskBar.$bar.getX()<=t}},{key:"updateBarPosition",value:function(t){var e=t.x,n=void 0===e?null:e,a=t.width,i=void 0===a?null:a,r=this.$bar;if(n){var o=this.task.getAllChildTaskWithThis.map(function(t){return t.taskBar.$bar.getX()}).reduce(function(t,e){return e<t?e:t});if(!this.isUpdatableX(o))return;r.setAttribute("x",(+n).toString())}i&&i>=this.gan2Chart.option.columnWidth&&r.setAttribute("width",(+i).toString()),this.updateLabelPosition(),this.updateHandlePosition(),this.$progressBar.setAttribute("x",this.$bar.getX()),this.$progressBar.setAttribute("width",this.$bar.getWidth()*(this.task.progress/100)),this.task._arrows.forEach(function(t){return t.update()})}},{key:"updateLabelPosition",value:function(){var t=this.$bar,e=this.$group.querySelector("."+T);e.getBBox().width>t.getWidth()?e.setAttribute("x",t.getX()+t.getWidth()+5):e.setAttribute("x",t.getX()+t.getWidth()/2)}},{key:"dateChange",value:function(t){var e=this.computeStartEndDate(),n=g(e,2),a=n[0],i=n[1],r=[this.task.startDate,this.task.endDate],o=r[0],s=r[1];this.task.startDate.getTime()!==a.getTime()&&(this.task.startDate=a),this.task.endDate.getTime()!==i.getTime()&&(this.task.endDate=i),this.gan2Chart._triggerEvent(t,"change",[this.task]),this.gan2Chart._triggerEvent(t,"taskChange",[this.task,o,s,a,i])}},{key:"progressChange",value:function(t){var e=this.task.progress,n=Math.floor(this.$progressBar.getWidth()/this.$bar.getWidth()*100);this.task.progress=n,this.gan2Chart._triggerEvent(t,"change",[this.task]),this.gan2Chart._triggerEvent(t,"taskProgressChange",[this.task,e,n])}},{key:"computeStartEndDate",value:function(){var t=this.$bar,e=t.getX()/this.gan2Chart.option.columnWidth,n=B.add(this.gan2Chart.startDate,e*this.gan2Chart.option.step,this.gan2Chart._viewMode-1),a=t.getWidth()/this.gan2Chart.option.columnWidth;return[n,B.add(n,a*this.gan2Chart.option.step,this.gan2Chart._viewMode-1)]}},{key:"updateHandlePosition",value:function(){var t=this.$bar,e=this.$handleGroup.querySelector("."+E+".left");e&&e.setAttribute("x",t.getX()+1);var n=this.$handleGroup.querySelector("."+E+".right");n&&n.setAttribute("x",t.getEndX()-9);var a=this.$handleGroup.querySelector("."+E+"."+$);a&&a.setAttribute("points",this.getProgressPolygonPoints())}},{key:"computeX",get:function(){var t=this.gan2Chart.option.columnWidth;return B.diff(this.gan2Chart.startDate,this.task.startDate,this.gan2Chart._viewMode)*t}},{key:"computeY",get:function(){return this.gan2Chart.option.headerHeight+this.gan2Chart.option.padding+this.task.index*(this.height+this.gan2Chart.option.padding)}}]),n}(),N=function(){function n(t,e){h(this,n),this.gan2Chart=t,this.$popupWrapper=t._$popupWrapper,this.customHtmlSupplier=e||this.defaultHtmlSupplier,this.hide()}return t(n,[{key:"show",value:function(t,e){t&&(this.task=t),this.html=this.customHtmlSupplier(this.task),this.html+='<div class="pointer"></div>',this.$popupWrapper.innerHTML=this.html;var n=this.$popupWrapper.querySelector(".pointer");n.style.transform="rotateZ(90deg)",n.style.left="-7px",n.style.top="2px";var a=[this.task.taskBar.$bar.getX(),this.task.taskBar.$bar.getY(),this.task.taskBar.$bar.getWidth()],i=a[0],r=a[1],o=a[2];e&&e.type.includes("mouse")&&(i=e.offsetX-o+10,r=e.offsetY-5),this.$popupWrapper.style.left=i+(o+10)+"px",this.$popupWrapper.style.top=r+"px",this.$popupWrapper.style.opacity="1"}},{key:"hide",value:function(){this.$popupWrapper.style.left="0px",this.$popupWrapper.style.top="0px",this.$popupWrapper.style.opacity="0"}},{key:"defaultHtmlSupplier",value:function(t){var e=B.format(t.startDate,"YYYY-MM-DD HH:mm:ss",this.gan2Chart.option.language),n=B.format(t.endDate,"YYYY-MM-DD HH:mm:ss",this.gan2Chart.option.language);return'<div class="title">'+t.name+'</div>\n            <div class="content">\n              <div>'+e+"</div>\n              <div>~ "+n+"</div>\n            </div>"}}]),n}(),R={headerHeight:50,columnWidth:40,step:24,barHeight:20,barCornerRadius:2,arrowCurve:5,padding:18,viewMode:"Day",weekendCheck:!0,popupTrigger:"mousemove",popupHtmlSupplier:null,autoScroll:!0,ignoreIndex:!0,language:"en",datePaddingQty:"auto",paddingBarCount:2};return function(){function a(t,e,n){h(this,a),this._gan2TaskIndex=0,this.chartDates=[],this.bars=[],this.isPopupOpen=!1,this.option=Object.assign({},R,n),this.constructOption=Object.assign({},this.option),this.option.startDate&&(this.startDate=B.parse(this.option.startDate)),this.option.endDate&&(this.endDate=B.parse(this.option.endDate)),this.setupWrapper(t),this.setupTasks(e),this.changeViewMode(),this.bindGridClickEvent(),this.bindBarEvent(),this.progressBarEventBind()}return t(a,[{key:"setupWrapper",value:function(t){var e=void 0,n=void 0;if("string"==typeof t){if(!(e=document.querySelector(t)))throw"Gan2Chart needs wrapper element"}else n=t instanceof HTMLElement?(e=t).querySelector("svg"):t;n?(this.$svg=n,this.$svg.className.add(o)):this.$svg=p("svg",{appendTo:e,class:o}),this._$container=document.createElement("div"),this._$container.classList.add(s),this.$svg.parentElement.appendChild(this._$container),this._$container.appendChild(this.$svg),this._$popupWrapper=document.createElement("div"),this._$popupWrapper.classList.add(u),this._$container.appendChild(this._$popupWrapper)}},{key:"setupTasks",value:function(t){var e=this;Array.isArray(t)?t[0]instanceof O&&(t=this.gan2TaskToTask(t)):t=[t],this.tasks=t.map(function(t){return new O(e,t,e._viewMode)}),this._gan2TaskLength=this._gan2TaskIndex+this.option.paddingBarCount}},{key:"changeViewMode",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.option.viewMode,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.option.autoScroll;this.option.viewMode=t.replace(" ","_").toUpperCase(),this.updateViewScale(),this.setupDate(),this.render(),this._hidePopup(),e&&this.setScrollPosition()}},{key:"updateViewScale",value:function(){switch(this._viewMode){case c.HOUR:this.option.step=2.5*this.constructOption.step,this.option.columnWidth=this.constructOption.columnWidth;break;case c.DAY:this.option.step=this.constructOption.step,this.option.columnWidth=this.constructOption.columnWidth;break;default:this.option.step=30*this.constructOption.step,this.option.columnWidth=2*this.constructOption.columnWidth}}},{key:"setupDate",value:function(){var h=this;!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:h._viewMode,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:h.option.datePaddingQty,n=function a(t,i,r){return t.forEach(function(t){if((!i||t.startDate.getTime()<i.getTime())&&(i=t.startDate),(!r||t.endDate.getTime()>r.getTime())&&(r=t.endDate),t.childTask){var e=a(t.childTask,i,r),n=g(e,2);i=n[0],r=n[1]}}),[i,r]}(h.tasks),a=g(n,2),i=a[0],r=a[1];if("string"==typeof e){var o=B.diff(i,r,t),s=t>=c.MONTH?18:30;e=o<s?(s-o)/2:4}h.option.startDate||(h.startDate=B.add(B.startOf(i,t),-e,t));h.option.endDate||(h.endDate=B.add(B.startOf(r,t),e,t))}(),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:h._viewMode;h.chartDates.splice(0);var e=B.clone(h.startDate);h.chartDates.push(e);for(;e<h.endDate;)e=B.add(e,1,t),h.chartDates.push(e)}()}},{key:"render",value:function(){this.$svg.innerHTML="",this.bars.splice(0),this.setupLayer(),this.drawGrid(),this.drawDateAndDivideBar(),this.drawGanttBars(),this.drawArrows()}},{key:"setScrollPosition",value:function(){var t=this.$svg.parentElement;if(t){var e=this.option.datePaddingQty;"string"==typeof e&&(e=4),t.scrollLeft=e*this.option.columnWidth-this.option.columnWidth}}},{key:"drawArrows",value:function(){this.tasks.forEach(function(t){return t._drawArrow()})}},{key:"setupLayer",value:function(){var t=!0,e=!(this._layers={}),n=void 0;try{for(var a,i=["grid","date","arrow","progress","bar","details"][Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var r=a.value;this._layers[r]=p("g",{class:r,appendTo:this.$svg})}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"drawGanttBars",value:function(){var e=this;this.tasks.forEach(function(t){return function e(n,t){t.childTask&&t.childTask.forEach(function(t){return e(n,t)});var a=new X(n,t);t.taskBar=a,n._layers.bar.appendChild(a.$group),n.bars.push(a)}(e,t)})}},{key:"drawGrid",value:function(){var s=this;s.gridWidth=s.chartDates.length*s.option.columnWidth,s.gridHeight=s.option.headerHeight+s.option.padding+(s.option.barHeight+s.option.padding)*s._gan2TaskLength,p("rect",{x:0,y:0,width:s.gridWidth,height:s.gridHeight,class:d,appendTo:s._layers.grid}),l.attr(s.$svg,{height:s.gridHeight,width:s.gridWidth}),function(){for(var t=p("g",{appendTo:s._layers.grid}),e=p("g",{appendTo:s._layers.grid}),n=s.chartDates.length*s.option.columnWidth,a=s.option.barHeight+s.option.padding,i=s.option.headerHeight+s.option.padding/2,r=0,o=s._gan2TaskLength;r<o;r++)p("rect",{x:0,y:i,width:n,height:a,class:f,appendTo:t}),p("line",{x1:0,y1:i+a,x2:n,y2:i+a,class:v,appendTo:e}),i+=s.option.barHeight+s.option.padding}(),p("rect",{x:0,y:0,width:s.chartDates.length*s.option.columnWidth,height:s.option.headerHeight+10,class:b,appendTo:s._layers.grid}),function(){for(var t=s.option.columnWidth,e=s.option.headerHeight+s.option.padding/2,n=(s.option.barHeight+s.option.padding)*s._gan2TaskLength,a=0,i=s.chartDates.length;a<i;a++)p("path",{d:"M "+t*a+" "+e+" v "+n,class:y,appendTo:s._layers.grid})}(),function(){var t=B.now(),e=s._viewMode;if(!(t<s.chartDates[0]||s.chartDates[s.chartDates.length-1]<t)){var n=B.diff(t,s.chartDates[0],e)*s.option.columnWidth,a=s.option.columnWidth,i=(s.option.barHeight+s.option.padding)*s._gan2TaskLength;p("rect",{x:n,y:s.option.headerHeight+s.option.padding/2,width:a,height:i,class:k,appendTo:s._layers.grid})}}(),function(){if(s.option.weekendCheck&&!(s._viewMode>c.DAY))for(var t=0;t<s.chartDates.length;t++){var e=s.chartDates[t],n=void 0;if(0===e.getDay()?n=w:6===e.getDay()&&(n=m),n){var a=t*s.option.columnWidth,i=s.option.columnWidth,r=(s.option.barHeight+s.option.padding)*s._gan2TaskLength;p("rect",{x:a,y:s.option.headerHeight+s.option.padding/2,width:i,height:r,class:n,appendTo:s._layers.grid})}}}()}},{key:"drawDateAndDivideBar",value:function(){for(var n,t=(n=this).chartDates.map(function(t,e){return n.getDateLabel(t,e)}),e=t[0],a=0,i=t.length-1;a<=i;a++){var r=t[a];if(p("text",{x:r.lowerX,y:r.lowerY,innerHTML:r.lowerText,class:S,appendTo:this._layers.date}),a===i||e.upperText!=r.upperText){var o=a===i?this.option.columnWidth/2:0,s=p("text",{x:(e.upperX+r.upperX)/2+o,y:e.upperY,innerHTML:e.upperText,class:W,appendTo:this._layers.date});if(s.getBBox().x>this._layers.grid.getBBox().width&&s.remove(),e.upperText===r.upperText)return;p("line",{x1:r.lowerX-this.option.columnWidth/2,y1:0,x2:r.lowerX-this.option.columnWidth/2,y2:this.gridHeight,class:Y,appendTo:this._layers.grid}),e=r}}}},{key:"getDateLabel",value:function(t,e){var n=B.getDateLabel(t,this._viewMode,this.option.language),a=n.lower,i=n.upper,r={x:e*this.option.columnWidth,lowerY:this.option.headerHeight,upperY:this.option.headerHeight-25};return{upperText:i,lowerText:a,upperX:r.x,upperY:r.upperY,lowerX:r.x+this.option.columnWidth/2,lowerY:i?r.lowerY:(r.upperY+r.lowerY)/2}}},{key:"bindGridClickEvent",value:function(){var e=this;l.on(this.$svg,this.option.popupTrigger,".grid",function(t){e._unSelectAll(),e._hidePopup(t)})}},{key:"bindBarEvent",value:function(){var r=this,o=0,s=!1,h=!1,p=!1,u=[],d=null;l.on(this.$svg,"mousedown","."+H+", ."+E,function(t,e){var n=l.closest("."+H,e);if(n.classList.add(x),!(!(d=r._getBar(n.getAttribute("data-id")))||d&&d.fixed)){var a=e.classList;a.contains("left")?h=!0:a.contains("right")?p=!0:a.contains(""+H)&&(s=!0),o=t.offsetX,t.offsetY,(u=d.task.getAllChildTaskWithThis.map(function(t){return t.taskBar})).forEach(function(t){var e=t.$bar;e.ox=e.getX(),e.oy=e.getY(),e.owidth=e.getWidth(),e.finaldx=0})}}),l.on(this.$svg,"mousemove",function(t){if(s||h||p){var a=t.offsetX-o,i=d;u.forEach(function(t){var e=t.$bar;if(e.finaldx=r.getSnapPosition(a),h)i===t?t.updateBarPosition({x:e.ox+e.finaldx,width:e.owidth-e.finaldx}):t.updateBarPosition({x:e.ox+e.finaldx});else if(p)t.updateBarPosition({width:e.owidth+e.finaldx});else if(s){var n=e.ox+e.finaldx;t.isUpdatableX(n)&&t.updateBarPosition({x:n})}}),a!==d.$bar.finaldx&&(r._draggingBar=i),d.dateChange(t),r._redrawPopup()}}),l.on(this.$svg,"mouseup",function(e){u.forEach(function(t){t.$bar.finaldx&&t.dateChange(e)}),r._draggingBar||e.target.parentElement.classList.contains(""+_)&&r._triggerEvent(e,"taskClick",[d.task])}),this._$container.addEventListener("mouseup",function(t){(s||h||p)&&u.forEach(function(t){return t.$group.classList.remove(""+x)}),p=h=s=!1;var e=r;e._draggingBar&&(r.setupDate(),r.render(),setTimeout(function(){return e._draggingBar=null},10))})}},{key:"progressBarEventBind",value:function(){var a=this,i=0,r=null,o=null,s=null,h=null;l.on(this.$svg,"mousedown","."+E+"."+$,function(t,e){r=!0,i=t.offsetX;var n=l.closest("."+H,e);o=a._getBar(n.getAttribute("data-id")),s=o.$bar,(h=o.$progressBar).finaldx=0,h.owidth=h.getWidth(),h.minDx=-h.getWidth(),h.maxDx=s.getWidth()-h.getWidth()}),l.on(this.$svg,"mousemove",function(t){if(r){var e=t.offsetX-i;e>h.maxDx&&(e=h.maxDx),e<h.minDx&&(e=h.minDx);var n=o.$handleProgress;l.attr(h,"width",h.owidth+e),l.attr(n,"points",o.getProgressPolygonPoints()),h.finaldx=e,o.progressChange(t),a._redrawPopup()}}),l.on(this.$svg,"mouseup",function(t){r=!1,h&&h.finaldx&&(o.progressChange(t),a._unSelectAll())})}},{key:"_redrawPopup",value:function(){this.isPopupOpen&&this._showPopup()}},{key:"_showPopup",value:function(t,e){this.popup||(this.popup=new N(this,this.option.popupHtmlSupplier)),this.isPopupOpen||this._triggerEvent(t,"popupOpen",[e]),this.isPopupOpen=!0,this.popup.show(e,t)}},{key:"_hidePopup",value:function(t){this.popup&&(this.isPopupOpen&&this._triggerEvent(t,"popupClose",[]),this.isPopupOpen=!1,this.popup.hide())}},{key:"_getBar",value:function(e){return this.bars.find(function(t){return t.task.id===e})}},{key:"getSnapPosition",value:function(t){var e=t,n=void 0;return this._viewMode===c.MONTH?e-(n=t%(this.option.columnWidth/30))+(n<this.option.columnWidth/60?0:this.option.columnWidth/30):e-(n=t%this.option.columnWidth)+(n<this.option.columnWidth/2?0:this.option.columnWidth)}},{key:"gan2TaskToTask",value:function(t){var n=this;return t.map(function(t){var e=t._task;return e.childTask=n.gan2TaskToTask(t.childTask),e})}},{key:"_unSelectAll",value:function(){this.$svg.querySelectorAll(".bar ."+H).forEach(function(t){return t.classList.remove(x)})}},{key:"_triggerEvent",value:function(t,e,n){var a,i=Object.keys(this.option).find(function(t){return t.toUpperCase()==="ON"+e.toUpperCase()});this.option[i]&&(a=this.option)[i].apply(a,[t].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n)))}},{key:"refresh",value:function(t){t&&this.setupTasks(t),this.changeViewMode()}},{key:"_viewMode",get:function(){var t=c[this.option.viewMode.replace(" ","_").toUpperCase()];return t||c.DAY}}]),a}()});
