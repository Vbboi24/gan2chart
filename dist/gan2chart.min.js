var Gan2Chart=function(){"use strict";!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".gan2 {\n  margin: auto; }\n  .gan2 .bar {\n    fill: white;\n    stroke: #bababa;\n    stroke-width: 0.5px;\n    transition: stroke-width .3s ease;\n    user-select: none;\n    cursor: pointer; }\n    .gan2 .bar .bar-wrapper:nth-of-type(n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group .bar-progress {\n          fill: beige; }\n        .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .bar {\n        fill: #f7f7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .bar-progress {\n        fill: #eaeab4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n).active .bar {\n        fill: #f7f7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n).active .bar-progress {\n        fill: #eaeab4; }\n    .gan2 .bar .bar-wrapper:nth-of-type(2n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group .bar-progress {\n          fill: #e9f5dc; }\n        .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .bar {\n        fill: #eef7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .bar-progress {\n        fill: #d0eab4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n).active .bar {\n        fill: #eef7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n).active .bar-progress {\n        fill: #d0eab4; }\n    .gan2 .bar .bar-wrapper:nth-of-type(3n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group .bar-progress {\n          fill: #e8dcf5; }\n        .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .bar {\n        fill: #ede4f7; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .bar-progress {\n        fill: #ceb4ea; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n).active .bar {\n        fill: #ede4f7; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n).active .bar-progress {\n        fill: #ceb4ea; }\n  .gan2 .grid-background {\n    fill: white; }\n  .gan2 .grid-header {\n    fill: #ffffff;\n    stroke: #e0e0e0;\n    stroke-width: 1.4px; }\n  .gan2 .grid-row {\n    fill: #ffffff; }\n  .gan2 .grid-row:nth-child(even) {\n    fill: #f5f5f5; }\n  .gan2 .row-line {\n    stroke: #ebeff2; }\n  .gan2 .tick {\n    stroke: #e0e0e0;\n    stroke-width: 0.4px; }\n    .gan2 .tick.thick {\n      stroke-width: 0.8px; }\n  .gan2 .today-highlight {\n    fill: #fcf8e3;\n    opacity: 0.5; }\n  .gan2 .arrow {\n    fill: none;\n    stroke: #666;\n    stroke-width: 1.4px; }\n  .gan2 .bar-progress {\n    fill: beige;\n    stroke: #bababa;\n    stroke-width: 0.5px; }\n  .gan2 .bar-invalid {\n    fill: transparent;\n    stroke: #8D99A6;\n    stroke-width: 1px;\n    stroke-dasharray: 5; }\n    .gan2 .bar-invalid ~ .bar-label {\n      fill: #555; }\n  .gan2 .bar-label {\n    fill: #fff;\n    dominant-baseline: central;\n    text-anchor: middle;\n    font-size: 12px;\n    font-weight: lighter; }\n  .gan2 .handle {\n    fill: #ddd;\n    cursor: ew-resize;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity .3s ease; }\n  .gan2 .lower-text, .gan2 .upper-text {\n    font-size: 12px;\n    text-anchor: middle; }\n  .gan2 .upper-text {\n    fill: #555; }\n  .gan2 .lower-text {\n    fill: #333; }\n  .gan2 .upper-division-bar {\n    stroke: #d8d8d8;\n    stroke-width: 0.5px; }\n  .gan2 .hide {\n    display: none; }\n  .gan2 .bar-fixed .bar {\n    stroke: #444;\n    stroke-dasharray: 5;\n    animation: dash-animation 2s linear;\n    animation-iteration-count: infinite;\n    animation-direction: alternate; }\n\n@keyframes dash-animation {\n  to {\n    stroke-dashoffset: 50px; } }\n\n.gan2-container {\n  position: relative;\n  overflow: auto;\n  font-size: 12px;\n  display: inline-block;\n  width: 100%;\n  border: 1px solid #e0e0e0; }\n  .gan2-container .popup-wrapper {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background: white;\n    padding: 1px;\n    text-align: left;\n    color: #333;\n    border-radius: 3px;\n    min-width: 100px;\n    opacity: 0;\n    -webkit-box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5);\n    -moz-box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5);\n    box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5); }\n    .gan2-container .popup-wrapper.block-event {\n      pointer-events: none; }\n    .gan2-container .popup-wrapper .title {\n      border-bottom: 2px solid #555;\n      padding: 2px 6px 2px 6px; }\n    .gan2-container .popup-wrapper .date {\n      color: #555;\n      padding: 2px 6px 1px 6px; }\n    .gan2-container .popup-wrapper .content {\n      color: #666;\n      padding: 1px 6px 2px 6px; }\n    .gan2-container .popup-wrapper .pointer {\n      position: absolute;\n      height: 5px;\n      margin: 0 0 0 -5px;\n      border: 5px solid transparent;\n      border-top-color: white; }\n");var g,t,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),a=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},c=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function d(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function p(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var r in e){if("appendTo"===r)e.appendTo.appendChild(n);else"innerHTML"===r?n.innerHTML=e.innerHTML:n.setAttribute(r,e[r])}return n}function r(t,e,n,r){var i=function(t,e,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"0.4s",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"0.1s",o=t.querySelector("animate");if(o)return d.attr(o,{attributeName:e,from:n,to:r,dur:i,begin:"click + "+a}),t;var s=p("animate",{attributeName:e,from:n,to:r,dur:i,begin:a,calcMode:"spline",values:n+";"+r,keyTimes:"0; 1",keySplines:(h="ease-out",{ease:".25 .1 .25 1",linear:"0 0 1 1","ease-in":".42 0 1 1","ease-out":"0 0 .58 1","ease-in-out":".42 0 .58 1"}[h])});var h;return t.appendChild(s),t}(t,e,n,r);if(i===t){var a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!0),a.eventName="click",i.dispatchEvent(a)}}SVGElement.prototype.getX=function(){return+this.getAttribute("x")},SVGElement.prototype.getY=function(){return+this.getAttribute("y")},SVGElement.prototype.getWidth=function(){return+this.getAttribute("width")},SVGElement.prototype.getHeight=function(){return+this.getAttribute("height")},SVGElement.prototype.getEndX=function(){return this.getX()+this.getWidth()},d.on=function(t,e,n,r){r?d.delegate(t,e,n,r):d.bind(t,e,r=n)},d.off=function(t,e,n){t.removeEventListener(e,n)},d.bind=function(e,t,n){t.split(/\s+/).forEach(function(t){e.addEventListener(t,n)})},d.delegate=function(t,e,n,r){t.addEventListener(e,function(t){var e=t.target.closest(n);e&&(t.delegatedTarget=e,r.call(this,t,e))})},d.closest=function(t,e){return e?e.matches(t)?e:d.closest(t,e.parentNode):null},d.attr=function(t,e,n){if(!n&&"string"==typeof e)return t.getAttribute(e);if("object"!==(void 0===e?"undefined":i(e)))t.setAttribute(e,n);else for(var r in e)d.attr(t,r,e[r])},(t=g||(g={}))[t.MILLISECOND=0]="MILLISECOND",t[t.SECOND=1]="SECOND",t[t.MINUTE=2]="MINUTE",t[t.HOUR=3]="HOUR",t[t.DAY=4]="DAY",t[t.MONTH=5]="MONTH",t[t.YEAR=6]="YEAR";var o="gan2",s="gan2-container",u="popup-wrapper",n="grid-background",l="grid-row",f="row-line",v="grid-header",b="tick",y="today-highlight",k="active",m="handle-group",w="bar",x="bar-label",T="progress",$="bar-progress",D="bar-fixed",M="bar-group",C="bar-wrapper",H="handle",E="upper-text",S="upper-division-bar",W="lower-text",Y={en:["January","February","March","April","May","June","July","August","September","October","November","December"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},_={ko:{year:"년",day:"일",hour:"시"}},A=function(){function l(){h(this,l)}return e(l,null,[{key:"parse",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"-",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:/[.:]/;if(!t)return new Date;if(t instanceof Date)return t;var r=t.split(" "),i=r[0].split(e).map(function(t){return parseInt(t,10)}),a=r[1]&&r[1].split(n);i[1]=i[1]-1,a&&a.length&&(4==a.length&&(a[3]="0."+a[3],a[3]=1e3*parseFloat(a[3])),i=i.concat(a));var o=c(i,6),s=o[0],h=o[1],p=o[2],u=o[3],d=o[4],l=o[5];return new Date(s,h,p,0|u,0|d,0|l)}},{key:"toString",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.getDateValues(t).map(function(t,e){return l.padStart((t=1===e?t+1:t)+"",6===e?3:2,"0")}),r=n[0]+"-"+n[1]+"-"+n[2],i=n[3]+":"+n[4]+":"+n[5]+"."+n[6];return r+(e?" "+i:"")}},{key:"format",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss.SSS",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",r=this.getDateValues(t).map(function(t){return l.padStart(t,2,0)}),i=function(t){return _[n]?_[n][t]:""},a={YYYY:r[0],MM:l.padStart(+r[1]+1,2,0),DD:r[2],HH:r[3],mm:r[4],ss:r[5],SSS:r[6],D:r[2],MMMM:Y[n][+r[1]],MMM:Y[n][+r[1]],DDDD:[+r[2]]+i("day"),HHHH:[+r[3]]+i("hour"),YYYYYYYY:[+r[0]+i("year")]},o=e,s=[];return Object.keys(a).sort(function(t,e){return e.length-t.length}).forEach(function(t){o.includes(t)&&(o=o.replace(t,"$"+s.length),s.push(a[t]))}),s.forEach(function(t,e){o=o.replace("$"+e,t)}),o}},{key:"diff",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:g.DAY,r=[t,e].map(function(t){return l.parse(t)}).map(function(t){return t.getTime()}).sort(function(t,e){return e-t}),i=c(r,2),a=i[0]-i[1],o=a/1e3,s=o/60,h=s/60,p=h/24,u=p/30,d=[a,o,s,h,p,u,u/12];return Math.floor(d[n])}},{key:"today",value:function(){var t=this.getDateValues().slice(0,3),e=c(t,3),n=e[0],r=e[1],i=e[2];return new Date(n,r,i)}},{key:"now",value:function(){return new Date}},{key:"add",value:function(t,e,n){var r;return new Date(t.getFullYear()+(n===g.YEAR?e:0),t.getMonth()+(n===g.MONTH?e:0),t.getDate()+(r=e,n===g.DAY?r:0),t.getHours()+(n===g.HOUR?e:0),t.getMinutes()+(n===g.MINUTE?e:0),t.getSeconds()+(n===g.SECOND?e:0),t.getMilliseconds()+(n===g.MILLISECOND?e:0))}},{key:"startOf",value:function(t,e){var n,r=(a(n={},g.YEAR,6),a(n,g.MONTH,5),a(n,g.DAY,4),a(n,g.HOUR,3),a(n,g.MINUTE,2),a(n,g.SECOND,1),a(n,g.MILLISECOND,0),n),i=function(t){return r[t]<=r[e]};return new Date(t.getFullYear(),i(g.YEAR)?0:t.getMonth(),i(g.MONTH)?1:t.getDate(),i(g.DAY)?0:t.getHours(),i(g.HOUR)?0:t.getMinutes(),i(g.MINUTE)?0:t.getSeconds(),i(g.SECOND)?0:t.getMilliseconds())}},{key:"clone",value:function(t){return new Date(t)}},{key:"getDateValues",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Date;return[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]}},{key:"getDateLabel",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",r=!!_[n],i="",a="",o=r?"YYYYYYYY":"YYYY",s=r?"HHHH":"HH",h=r?"DDDD":"D",p=r?"MMMM":"MMM",u=r?"MMM "+h:h+" MMM";switch(e){case g.YEAR:i=l.format(t,""+o,n);break;case g.MONTH:a=t.getFullYear()?l.format(t,""+o,n):"",i=l.format(t,""+p,n);break;case g.HOUR:a=t.getDate()?l.format(t,""+u,n):"",i=l.format(t,""+s,n);break;default:a=t.getMonth()||0===t.getMonth()?l.format(t,"MMMM",n):"",i=l.format(t,""+h,n)}return{lower:i,upper:a}}},{key:"padStart",value:function(t,e,n){return t+="",e>>=0,n=String(void 0!==n?n:" "),t.length>e?String(t):((e-=t.length)>n.length&&(n+=n.repeat(e/n.length)),n.slice(0,e)+String(t))}}]),l}(),P=function(){function r(t,e,n){h(this,r),this.gantt=t,this.fromTask=e,this.toTask=n,this.calculatePath(),this.create()}return e(r,[{key:"calculatePath",value:function(){var t=this.gantt.option,e=t.arrowCurve,n=t.headerHeight,r=t.barHeight,i=t.padding,a=[this.fromTask.taskBar,this.toTask.taskBar],o=a[0],s=a[1],h=s.$bar.getX()-20;h<o.$bar.getX()+20?h=o.$bar.getX()+20:h>o.$bar.getX()+o.$bar.getWidth()-20&&(h=o.$bar.getX()+o.$bar.getWidth()-20);var p=n+r+(i+r)*this.fromTask.index+i,u=s.$bar.getX()-i/2,d=n+r/2+(i+r)*this.toTask.index+i,l=this.fromTask.index>this.toTask.index,g=l?1:0,c=l?-e:e,f=d+(l?+e:-e);if(this.path="M "+h+" "+p+"\n                 V "+f+"\n                 a "+e+" "+e+" 0 0 "+g+" "+e+" "+c+"\n                 L "+u+" "+d+"\n                 m -5 -5\n                 l 5 5\n                 l -5 5",s.$bar.getX()<=o.$bar.getX()+i){var v=i/2-e,b=s.$bar.getY()+s.height/2-c,y=s.$bar.getX()-i;this.path="M "+h+" "+p+"\n                   v "+v+"\n                   a "+e+" "+e+" 0 0 1 -"+e+" "+e+"\n                   H "+y+"\n                   a "+e+" "+e+" 0 0 "+g+" -"+e+" "+c+"\n                   V "+b+"\n                   a "+e+" "+e+" 0 0 "+g+" "+e+" "+c+"\n                   L "+u+" "+d+"\n                   m -5 -5\n                   l 5 5\n                   l -5 5"}}},{key:"create",value:function(){this.$element=p("path",{d:this.path,class:this.toTask.customArrowClass,"data-from":this.fromTask.id,"data-to":this.toTask.id})}},{key:"update",value:function(){this.calculatePath(),this.$element.setAttribute("d",this.path)}}]),r}(),B=function(){function s(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:g.DAY,r=this,i=arguments[3],a=arguments[4];if(h(this,s),this.gan2Chart=e,this._task=t,this.id=a?a.toString():s.generateId(t),this.name=t.name,this.index=e._gan2TaskIndex++,this.start=A.parse(t.start),this.end=A.parse(t.end),this.progress=t.progress,this.progressFixed=t.progressFixed,this.customArrowClass=t.customArrowClass,this.customClass=t.customClass,this.fixed=t.fixed,this.parentTask=i,this.childTask=[],this.arrows=[],t.start||t.end)this.start=A.parse(this.start)||A.add(this.end,-2,n),this.end=A.parse(this.end)||A.add(this.start,2,n);else{var o=A.today();this.start=o,this.end=A.add(o,2,n)}A.getDateValues(this.end).slice(3).every(function(t){return 0===t})&&(this.end=A.add(this.end,24,g.HOUR)),t.childTask&&(this.childTask=t.childTask.map(function(t){return new s(e,t,n,r)}))}return e(s,[{key:"drawArrow",value:function(t){var n=this;if(this.arrows=[].concat(this.childTask.reduce(function(t,e){return t.concat(e.drawArrow(n.id))},[])),t){var e=new P(this.gan2Chart,this.parentTask,this);this.gan2Chart._layers.arrow.appendChild(e.$element),this.arrows.push(e)}return this.arrows}},{key:"getAllChildTaskWithThis",get:function(){return this.childTask.reduce(function(t,e){return t.concat(e.getAllChildTaskWithThis)},[]).concat(this)}},{key:"length",get:function(){return this.childTask.reduce(function(t,e){return t+1},0)+1}}],[{key:"generateId",value:function(t){return t.name+"_"+Math.random().toString(36).slice(2,12)}}]),s}(),L=function(){function n(t,e){h(this,n),this.gan2Chart=t,this.task=e,this.fixed=e.fixed,this.progressfixed=e.progressFixed,this.prepareValues(),this.draw(),this.bindPopupEvent()}return e(n,[{key:"prepareValues",value:function(){this.duration=A.diff(this.task.end,this.task.start,this.gan2Chart._viewMode-1)/this.gan2Chart.option.step,this.width=this.gan2Chart.option.columnWidth*this.duration,this.height=this.gan2Chart.option.barHeight,this.x=this.computeX,this.y=this.computeY,this.cornerRadius=this.gan2Chart.option.barCornerRadius,this.progressWidth=this.gan2Chart.option.columnWidth*this.duration*(this.task.progress/100)||0,this.$group=p("g",{class:C+" "+(this.task.customClass||""),"data-id":this.task.id}),this.$barGroup=p("g",{class:""+M,appendTo:this.$group}),this.$handleGroup=p("g",{class:""+m,appendTo:this.$group})}},{key:"draw",value:function(){this.drawBar(),this.drawProgressBar(),this.drawLabel(),this.drawResizeHandles()}},{key:"drawBar",value:function(){this.$bar=p("rect",{x:this.x,y:this.y,width:this.width,height:this.height,rx:this.cornerRadius,ry:this.cornerRadius,class:""+w,appendTo:this.$barGroup}),r(this.$bar,"width",0,this.width),this.fixed&&this.$barGroup.classList.add(""+D)}},{key:"drawProgressBar",value:function(){this.$progressBar=p("rect",{x:this.x,y:this.y,width:this.progressWidth,height:this.height,rx:this.cornerRadius,ry:this.cornerRadius,class:""+$,appendTo:this.$barGroup}),r(this.$progressBar,"width",0,this.progressWidth)}},{key:"drawLabel",value:function(){var t=this;p("text",{x:this.x+this.width/2,y:this.y+this.height/2,innerHTML:this.task.name,class:""+x,appendTo:this.$barGroup}),requestAnimationFrame(function(){return t.updateLabelPosition()})}},{key:"drawResizeHandles",value:function(){if(!this.fixed){var t=this.$bar;p("rect",{x:t.getX()+t.getWidth()-9,y:t.getY()+1,width:8,height:this.height-2,rx:this.cornerRadius,ry:this.cornerRadius,class:H+" right",appendTo:this.$handleGroup}),p("rect",{x:t.getX()+1,y:t.getY()+1,width:8,height:this.height-2,rx:this.cornerRadius,ry:this.cornerRadius,class:H+" left",appendTo:this.$handleGroup}),this.task.progress&&this.task.progress<100&&!this.progressfixed&&(this.$handleProgress=p("polygon",{points:this.getProgressPolygonPoints(),class:H+" "+T,appendTo:this.$handleGroup}))}}},{key:"getProgressPolygonPoints",value:function(){var t=this.$progressBar;return[t.getEndX()-5,t.getY()+t.getHeight(),t.getEndX()+5,t.getY()+t.getHeight(),t.getEndX(),t.getY()+t.getHeight()-8.66].toString()}},{key:"bindPopupEvent",value:function(){var e=this,n=this.gan2Chart.option.popupTrigger;n.includes("click")&&(d.on(this.$group,"mousedown",function(t){return e.gan2Chart._$popupWrapper.classList.add("block-event")}),d.on(this.$group,"mouseup",function(t){return e.gan2Chart._$popupWrapper.classList.remove("block-event")})),d.on(this.$group,"focus "+n,function(t){e.gan2Chart._draggingBar||(e.gan2Chart._draggingBar||t.type!==n||e.gan2Chart._showPopup(t,e.task),e.gan2Chart._unSelectAll(),e.$group.classList.toggle("."+k))}),n.includes("mouse")&&(this.gan2Chart._$popupWrapper.classList.add("block-event"),d.on(this.$group,"mouseleave",function(t){return e.gan2Chart._hidePopup(t)}))}},{key:"isUpdatableX",value:function(t){return!this.task.parentTask||this.task.parentTask.taskBar.$bar.getX()<=t}},{key:"updateBarPosition",value:function(t){var e=t.x,n=void 0===e?null:e,r=t.width,i=void 0===r?null:r,a=this.$bar;if(n){var o=this.task.getAllChildTaskWithThis.map(function(t){return t.taskBar.$bar.getX()}).reduce(function(t,e){return e<t?e:t});if(!this.isUpdatableX(o))return;a.setAttribute("x",(+n).toString())}i&&i>=this.gan2Chart.option.columnWidth&&a.setAttribute("width",(+i).toString()),this.updateLabelPosition(),this.updateHandlePosition(),this.$progressBar.setAttribute("x",this.$bar.getX()),this.$progressBar.setAttribute("width",this.$bar.getWidth()*(this.task.progress/100)),this.task.arrows.forEach(function(t){return t.update()})}},{key:"updateLabelPosition",value:function(){var t=this.$bar,e=this.$group.querySelector("."+x);e.getBBox().width>t.getWidth()?e.setAttribute("x",t.getX()+t.getWidth()+5):e.setAttribute("x",t.getX()+t.getWidth()/2)}},{key:"dateChange",value:function(t){var e=this.computeStartEndDate(),n=c(e,2),r=n[0],i=n[1],a=[this.task.start,this.task.end],o=a[0],s=a[1];this.task.start.getTime()!==r.getTime()&&(this.task.start=r),this.task.end.getTime()!==i.getTime()&&(this.task.end=i),this.gan2Chart.triggerEvent(t,"change",[this.task]),this.gan2Chart.triggerEvent(t,"taskChange",[this.task,o,s,r,i])}},{key:"progressChange",value:function(t){var e=this.task.progress,n=Math.floor(this.$progressBar.getWidth()/this.$bar.getWidth()*100);this.task.progress=n,this.gan2Chart.triggerEvent(t,"change",[this.task]),this.gan2Chart.triggerEvent(t,"taskProgressChange",[this.task,e,n])}},{key:"computeStartEndDate",value:function(){var t=this.$bar,e=t.getX()/this.gan2Chart.option.columnWidth,n=A.add(this.gan2Chart.startDate,e*this.gan2Chart.option.step,this.gan2Chart._viewMode-1),r=t.getWidth()/this.gan2Chart.option.columnWidth;return[n,A.add(n,r*this.gan2Chart.option.step,this.gan2Chart._viewMode-1)]}},{key:"updateHandlePosition",value:function(){var t=this.$bar,e=this.$handleGroup.querySelector("."+H+".left");e&&e.setAttribute("x",t.getX()+1);var n=this.$handleGroup.querySelector("."+H+".right");n&&n.setAttribute("x",t.getEndX()-9);var r=this.$handleGroup.querySelector("."+H+"."+T);r&&r.setAttribute("points",this.getProgressPolygonPoints())}},{key:"computeX",get:function(){var t=this.gan2Chart.option.columnWidth;return A.diff(this.gan2Chart.startDate,this.task.start,this.gan2Chart._viewMode)*t}},{key:"computeY",get:function(){return this.gan2Chart.option.headerHeight+this.gan2Chart.option.padding+this.task.index*(this.height+this.gan2Chart.option.padding)}}]),n}(),O=function(){function n(t,e){h(this,n),this.gan2Chart=t,this.$popupWrapper=t._$popupWrapper,this.customHtmlSupplier=e||this.defaultHtmlSupplier,this.hide()}return e(n,[{key:"show",value:function(t,e){t&&(this.task=t),this.html=this.customHtmlSupplier(this.task),this.html+='<div class="pointer"></div>',this.$popupWrapper.innerHTML=this.html;var n=this.$popupWrapper.querySelector(".pointer");n.style.transform="rotateZ(90deg)",n.style.left="-7px",n.style.top="2px";var r=[this.task.taskBar.$bar.getX()+this.gan2Chart._$container.clientLeft,this.task.taskBar.$bar.getY(),this.task.taskBar.$bar.getWidth()],i=r[0],a=r[1],o=r[2];e&&e.type.includes("mouse")&&(i=e.offsetX-o+10,a=e.offsetY-5),this.$popupWrapper.style.left=i+(o+10)+"px",this.$popupWrapper.style.top=a+"px",this.$popupWrapper.style.opacity="1"}},{key:"hide",value:function(){this.$popupWrapper.style.left="0px",this.$popupWrapper.style.top="0px",this.$popupWrapper.style.opacity="0"}},{key:"defaultHtmlSupplier",value:function(t){var e=A.format(t.start,"YYYY-MM-DD HH:mm:ss",this.gan2Chart.option.language),n=A.format(t.end,"YYYY-MM-DD HH:mm:ss",this.gan2Chart.option.language);return'<div class="title">'+t.name+'</div>\n            <div class="content">\n              <div>'+e+"</div>\n              <div>~ "+n+"</div>\n            </div>"}}]),n}(),X={headerHeight:50,columnWidth:40,step:24,barHeight:20,barCornerRadius:2,arrowCurve:5,padding:18,viewMode:"Day",popupTrigger:"mousemove",popupHtmlSupplier:null,autoScroll:!0,language:"en",datePaddingQty:"auto",paddingBarCount:2};return function(){function r(t,e,n){h(this,r),this._gan2TaskIndex=0,this.chartDates=[],this.bars=[],this.isPopupOpen=!1,this.option=Object.assign({},X,n),this.constructOption=Object.assign({},this.option),this.option.startDate&&(this.startDate=A.parse(this.option.startDate)),this.option.endDate&&(this.endDate=A.parse(this.option.endDate)),this.setupWrapper(t),this.setupTasks(e),this.changeViewMode(),this.bindGridClickEvent(),this.bindBarEvent(),this.progressBarEventBind()}return e(r,[{key:"setupWrapper",value:function(t){var e=void 0,n=void 0;"string"==typeof t?e=document.querySelector(t):n=t instanceof HTMLElement?(e=t).querySelector("svg"):t,n?(this.$svg=n,this.$svg.className.add(o)):this.$svg=p("svg",{appendTo:e,class:o}),this._$container=document.createElement("div"),this._$container.classList.add(s),this.$svg.parentElement.appendChild(this._$container),this._$container.appendChild(this.$svg),this._$popupWrapper=document.createElement("div"),this._$popupWrapper.classList.add(u),this._$container.appendChild(this._$popupWrapper)}},{key:"setupTasks",value:function(t){var e=this;t instanceof Array?t[0]instanceof B&&(t=this.gan2TaskToTask(t)):t=[t],this.tasks=t.map(function(t){return new B(e,t,e._viewMode)}),this._gan2TaskLength=this.tasks.reduce(function(t,e){return t+e.length},0)+this.option.paddingBarCount}},{key:"changeViewMode",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.option.viewMode,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.option.autoScroll;this.option.viewMode=t.replace(" ","_").toUpperCase(),this.updateViewScale(),this.setupDate(),this.render(),this._hidePopup(),e&&this.setScrollPosition()}},{key:"updateViewScale",value:function(){switch(this._viewMode){case g.HOUR:this.option.step=2.5*this.constructOption.step,this.option.columnWidth=this.constructOption.columnWidth;break;case g.DAY:this.option.step=this.constructOption.step,this.option.columnWidth=this.constructOption.columnWidth;break;default:this.option.step=30*this.constructOption.step,this.option.columnWidth=2*this.constructOption.columnWidth}}},{key:"setupDate",value:function(){var h=this;!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:h._viewMode,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:h.option.datePaddingQty,n=function r(t,i,a){return t.forEach(function(t){if((!i||t.start.getTime()<i.getTime())&&(i=t.start),(!a||t.end.getTime()>a.getTime())&&(a=t.end),t.childTask){var e=r(t.childTask,i,a),n=c(e,2);i=n[0],a=n[1]}}),[i,a]}(h.tasks),r=c(n,2),i=r[0],a=r[1];if("string"==typeof e){var o=A.diff(i,a,t),s=t>=g.MONTH?18:30;e=o<s?(s-o)/2:4}h.option.startDate||(h.startDate=A.add(A.startOf(i,t),-e,t));h.option.endDate||(h.endDate=A.add(A.startOf(a,t),e,t))}(),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:h._viewMode;h.chartDates.splice(0);var e=A.clone(h.startDate);h.chartDates.push(e);for(;e<h.endDate;)e=A.add(e,1,t),h.chartDates.push(e)}()}},{key:"render",value:function(){this.$svg.innerHTML="",this.bars.splice(0),this.setupLayer(),this.drawGrid(),this.drawDateAndDivideBar(),this.drawGanttBars(),this.drawArrows()}},{key:"setScrollPosition",value:function(){var t=this.$svg.parentElement;if(t){var e=this.option.datePaddingQty;"string"==typeof e&&(e=4),t.scrollLeft=e*this.option.columnWidth-this.option.columnWidth}}},{key:"drawArrows",value:function(){this.tasks.reduce(function(t,e){return t.concat(e.drawArrow())},[])}},{key:"setupLayer",value:function(){var t=!0,e=!(this._layers={}),n=void 0;try{for(var r,i=["grid","date","arrow","progress","bar","details"][Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=r.value;this._layers[a]=p("g",{class:a,appendTo:this.$svg})}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"drawGanttBars",value:function(){var e=this;this.tasks.forEach(function(t){return function e(n,t){t.childTask&&t.childTask.forEach(function(t){return e(n,t)});var r=new L(n,t);t.taskBar=r,n._layers.bar.appendChild(r.$group),n.bars.push(r)}(e,t)})}},{key:"drawGrid",value:function(){var t,e,s=this;s.gridWidth=s.chartDates.length*s.option.columnWidth,s.gridHeight=s.option.headerHeight+s.option.padding+(s.option.barHeight+s.option.padding)*s._gan2TaskLength,p("rect",{x:0,y:0,width:s.gridWidth,height:s.gridHeight,class:n,appendTo:s._layers.grid}),d.attr(s.$svg,{height:s.gridHeight,width:s.gridWidth}),function(){for(var t=p("g",{appendTo:s._layers.grid}),e=p("g",{appendTo:s._layers.grid}),n=s.chartDates.length*s.option.columnWidth,r=s.option.barHeight+s.option.padding,i=s.option.headerHeight+s.option.padding/2,a=0,o=s._gan2TaskLength;a<o;a++)p("rect",{x:0,y:i,width:n,height:r,class:l,appendTo:t}),p("line",{x1:0,y1:i+r,x2:n,y2:i+r,class:f,appendTo:e}),i+=s.option.barHeight+s.option.padding}(),p("rect",{x:0,y:0,width:s.chartDates.length*s.option.columnWidth,height:s.option.headerHeight+10,class:v,appendTo:s._layers.grid}),function(){for(var t=s.option.columnWidth,e=s.option.headerHeight+s.option.padding/2,n=(s.option.barHeight+s.option.padding)*s._gan2TaskLength,r=0,i=s.chartDates.length;r<i;r++)p("path",{d:"M "+t*r+" "+e+" v "+n,class:b,appendTo:s._layers.grid})}(),t=A.now(),e=s._viewMode,t<s.chartDates[0]||s.chartDates[s.chartDates.length-1]<t||p("rect",{x:A.diff(t,s.chartDates[0],e)*s.option.columnWidth,y:0,width:s.option.columnWidth,height:(s.option.barHeight+s.option.padding)*s._gan2TaskLength+s.option.headerHeight+s.option.padding/2,class:y,appendTo:s._layers.grid})}},{key:"drawDateAndDivideBar",value:function(){for(var n,t=(n=this).chartDates.map(function(t,e){return n.getDateLabel(t,e)}),e=t[0],r=0,i=t.length-1;r<=i;r++){var a=t[r];if(p("text",{x:a.lowerX,y:a.lowerY,innerHTML:a.lowerText,class:W,appendTo:this._layers.date}),r===i||e.upperText!=a.upperText){var o=r===i?this.option.columnWidth/2:0,s=p("text",{x:(e.upperX+a.upperX)/2+o,y:e.upperY,innerHTML:e.upperText,class:E,appendTo:this._layers.date});if(s.getBBox().x2>this._layers.grid.getBBox().width&&s.remove(),e.upperText===a.upperText)return;p("line",{x1:a.lowerX-this.option.columnWidth/2,y1:0,x2:a.lowerX-this.option.columnWidth/2,y2:this.gridHeight,class:S,appendTo:this._layers.grid}),e=a}}}},{key:"getDateLabel",value:function(t,e){var n=A.getDateLabel(t,this._viewMode,this.option.language),r=n.lower,i=n.upper,a={x:e*this.option.columnWidth,lowerY:this.option.headerHeight,upperY:this.option.headerHeight-25};return{upperText:i,lowerText:r,upperX:a.x,upperY:a.upperY,lowerX:a.x+this.option.columnWidth/2,lowerY:i?a.lowerY:(a.upperY+a.lowerY)/2}}},{key:"bindGridClickEvent",value:function(){var e=this;d.on(this.$svg,this.option.popupTrigger,"."+l+", ."+v,function(t){e._unSelectAll(),e._hidePopup(t)})}},{key:"bindBarEvent",value:function(){var i=this,a=0,o=!1,s=!1,h=!1,p=[],u=null;d.on(this.$svg,"mousedown","."+C+", ."+H,function(t,e){var n=d.closest("."+C,e);if(n.classList.add(k),!(!(u=i.getBar(n.getAttribute("data-id")))||u&&u.fixed)){var r=e.classList;r.contains("left")?s=!0:r.contains("right")?h=!0:r.contains(""+C)&&(o=!0),a=t.offsetX,t.offsetY,(p=u.task.getAllChildTaskWithThis.map(function(t){return t.taskBar})).forEach(function(t){var e=t.$bar;e.ox=e.getX(),e.oy=e.getY(),e.owidth=e.getWidth(),e.finaldx=0})}}),d.on(this.$svg,"mousemove",function(t){if(o||s||h){var r=t.offsetX-a;i._draggingBar=u,p.forEach(function(t){var e=t.$bar;if(e.finaldx=i.getSnapPosition(r),s)i._draggingBar===t?t.updateBarPosition({x:e.ox+e.finaldx,width:e.owidth-e.finaldx}):t.updateBarPosition({x:e.ox+e.finaldx});else if(h)t.updateBarPosition({width:e.owidth+e.finaldx});else if(o){var n=e.ox+e.finaldx;t.isUpdatableX(n)&&t.updateBarPosition({x:n})}}),u.dateChange(t),i._redrawPopup()}}),d.on(this.$svg,"mouseup",function(e){p.forEach(function(t){t.$bar.finaldx&&t.dateChange(e)}),i._draggingBar||e.target.parentElement.classList.contains(""+M)&&i.triggerEvent(e,"taskClick",[u.task])}),document.addEventListener("mouseup",function(t){(o||s||h)&&p.forEach(function(t){return t.$group.classList.remove(""+k)}),h=s=o=!1;var e=i;e._draggingBar&&(i.setupDate(),i.render(),setTimeout(function(){return e._draggingBar=null},10))})}},{key:"progressBarEventBind",value:function(){var r=this,i=0,a=null,o=null,s=null,h=null;d.on(this.$svg,"mousedown","."+H+"."+T,function(t,e){a=!0,i=t.offsetX;var n=d.closest("."+C,e);o=r.getBar(n.getAttribute("data-id")),s=o.$bar,(h=o.$progressBar).finaldx=0,h.owidth=h.getWidth(),h.minDx=-h.getWidth(),h.maxDx=s.getWidth()-h.getWidth()}),d.on(this.$svg,"mousemove",function(t){if(a){var e=t.offsetX-i;r._draggingBar=o,e>h.maxDx&&(e=h.maxDx),e<h.minDx&&(e=h.minDx);var n=o.$handleProgress;d.attr(h,"width",h.owidth+e),d.attr(n,"points",o.getProgressPolygonPoints()),h.finaldx=e,o.progressChange(t),r._redrawPopup()}}),d.on(this.$svg,"mouseup",function(t){a=!1,h&&h.finaldx&&(o.progressChange(t),r._unSelectAll())})}},{key:"_redrawPopup",value:function(){this.isPopupOpen&&this._showPopup()}},{key:"_showPopup",value:function(t,e){this.popup||(this.popup=new O(this,this.option.popupHtmlSupplier)),this.isPopupOpen||this.triggerEvent(t,"popupOpen",[e]),this.isPopupOpen=!0,this.popup.show(e,t)}},{key:"_hidePopup",value:function(t){this.popup&&(this.isPopupOpen&&this.triggerEvent(t,"popupClose",[]),this.isPopupOpen=!1,this.popup.hide())}},{key:"getBar",value:function(e){return this.bars.find(function(t){return t.task.id===e})}},{key:"getSnapPosition",value:function(t){var e=t,n=void 0;return this._viewMode===g.MONTH?e-(n=t%(this.option.columnWidth/30))+(n<this.option.columnWidth/60?0:this.option.columnWidth/30):e-(n=t%this.option.columnWidth)+(n<this.option.columnWidth/2?0:this.option.columnWidth)}},{key:"gan2TaskToTask",value:function(t){var n=this;return t.map(function(t){var e=t._task;return e.childTask=n.gan2TaskToTask(t.childTask),e})}},{key:"_unSelectAll",value:function(){this.$svg.querySelectorAll(".bar ."+C).forEach(function(t){return t.classList.remove(k)})}},{key:"triggerEvent",value:function(t,e,n){var r,i=Object.keys(this.option).find(function(t){return t.toUpperCase()==="ON"+e.toUpperCase()});this.option[i]&&(r=this.option)[i].apply(r,[t].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n)))}},{key:"refresh",value:function(t){t&&this.setupTasks(t),this.changeViewMode()}},{key:"_viewMode",get:function(){var t=g[this.option.viewMode.replace(" ","_").toUpperCase()];return t||g.DAY}}]),r}()}();
