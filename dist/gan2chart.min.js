"use strict";function styleInject(t,e){void 0===e&&(e={});var a=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===a&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}var css=".gan2 {\n  border: 1px solid #e0e0e0; }\n  .gan2 .bar {\n    fill: white;\n    stroke: #bababa;\n    stroke-width: 0.5px;\n    transition: stroke-width .3s ease;\n    user-select: none;\n    cursor: pointer; }\n    .gan2 .bar .bar-wrapper:nth-of-type(n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group .bar-progress {\n          fill: beige; }\n        .gan2 .bar .bar-wrapper:nth-of-type(n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .bar {\n        fill: #f7f7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .bar-progress {\n        fill: #eaeab4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n).active .bar {\n        fill: #f7f7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(n).active .bar-progress {\n        fill: #eaeab4; }\n    .gan2 .bar .bar-wrapper:nth-of-type(2n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group .bar-progress {\n          fill: #e9f5dc; }\n        .gan2 .bar .bar-wrapper:nth-of-type(2n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .bar {\n        fill: #eef7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .bar-progress {\n        fill: #d0eab4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n).active .bar {\n        fill: #eef7e4; }\n      .gan2 .bar .bar-wrapper:nth-of-type(2n).active .bar-progress {\n        fill: #d0eab4; }\n    .gan2 .bar .bar-wrapper:nth-of-type(3n) {\n      cursor: pointer;\n      outline: none; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group {\n        stroke: transparent; }\n        .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group .bar-progress {\n          fill: #e8dcf5; }\n        .gan2 .bar .bar-wrapper:nth-of-type(3n) .bar-group .bar-label {\n          stroke: transparent;\n          fill: #333; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .bar {\n        fill: #ede4f7; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .bar-progress {\n        fill: #ceb4ea; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n):hover .handle {\n        visibility: visible;\n        opacity: 1; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n).active .bar {\n        fill: #ede4f7; }\n      .gan2 .bar .bar-wrapper:nth-of-type(3n).active .bar-progress {\n        fill: #ceb4ea; }\n  .gan2 .grid-background {\n    fill: white; }\n  .gan2 .grid-header {\n    fill: #ffffff;\n    stroke: #e0e0e0;\n    stroke-width: 1.4px; }\n  .gan2 .grid-row {\n    fill: #ffffff; }\n  .gan2 .grid-row:nth-child(even) {\n    fill: #f5f5f5; }\n  .gan2 .row-line {\n    stroke: #ebeff2; }\n  .gan2 .tick {\n    stroke: #e0e0e0;\n    stroke-width: 0.4px; }\n    .gan2 .tick.thick {\n      stroke-width: 0.8px; }\n  .gan2 .today-highlight {\n    fill: #fcf8e3;\n    opacity: 0.5; }\n  .gan2 .arrow {\n    fill: none;\n    stroke: #666;\n    stroke-width: 1.4px; }\n  .gan2 .bar-progress {\n    fill: beige;\n    stroke: #bababa;\n    stroke-width: 0.5px; }\n  .gan2 .bar-invalid {\n    fill: transparent;\n    stroke: #8D99A6;\n    stroke-width: 1px;\n    stroke-dasharray: 5; }\n    .gan2 .bar-invalid ~ .bar-label {\n      fill: #555; }\n  .gan2 .bar-label {\n    fill: #fff;\n    dominant-baseline: central;\n    text-anchor: middle;\n    font-size: 12px;\n    font-weight: lighter; }\n  .gan2 .handle {\n    fill: #ddd;\n    cursor: ew-resize;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity .3s ease; }\n  .gan2 .lower-text, .gan2 .upper-text {\n    font-size: 12px;\n    text-anchor: middle; }\n  .gan2 .upper-text {\n    fill: #555; }\n  .gan2 .lower-text {\n    fill: #333; }\n  .gan2 .upper-division-bar {\n    stroke: #d8d8d8;\n    stroke-width: 0.5px; }\n  .gan2 .hide {\n    display: none; }\n  .gan2 .bar-fixed .bar {\n    stroke: #444;\n    stroke-dasharray: 5;\n    animation: dash-animation 2s linear;\n    animation-iteration-count: infinite;\n    animation-direction: alternate; }\n\n@keyframes dash-animation {\n  to {\n    stroke-dashoffset: 50px; } }\n\n.gan2-container {\n  position: relative;\n  overflow: auto;\n  font-size: 12px;\n  display: inline-block;\n  text-align: left !important; }\n  .gan2-container .popup-wrapper {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background: white;\n    padding: 1px;\n    color: #333;\n    border-radius: 3px;\n    min-width: 100px;\n    opacity: 0;\n    -webkit-box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5);\n    -moz-box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5);\n    box-shadow: 1px 2px 5px 2px rgba(204, 204, 204, 0.5); }\n    .gan2-container .popup-wrapper.block-event {\n      pointer-events: none; }\n    .gan2-container .popup-wrapper .title {\n      border-bottom: 2px solid #555;\n      padding: 2px 6px 2px 6px; }\n    .gan2-container .popup-wrapper .date {\n      color: #555;\n      padding: 2px 6px 1px 6px; }\n    .gan2-container .popup-wrapper .content {\n      color: #666;\n      padding: 1px 6px 2px 6px; }\n    .gan2-container .popup-wrapper .pointer {\n      position: absolute;\n      height: 5px;\n      margin: 0 0 0 -5px;\n      border: 5px solid transparent;\n      border-top-color: white; }\n";styleInject(css);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function r(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,a){return e&&r(t.prototype,e),a&&r(t,a),t}}(),defineProperty=function(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t},slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var a=[],r=!0,n=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!e||a.length!==e);r=!0);}catch(t){n=!0,i=t}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return a}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},toConsumableArray=function(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)};function createSVG(t,e){var a=document.createElementNS("http://www.w3.org/2000/svg",t);for(var r in e)"appendTo"===r?e.appendTo.appendChild(a):"innerHTML"===r?a.innerHTML=e.innerHTML:a.setAttribute(r,e[r]);return a}function animateSVG(t,e,a,r){var n=getAnimationElement(t,e,a,r);if(n===t){var i=document.createEvent("HTMLEvents");i.initEvent("click",!0,!0),i.eventName="click",n.dispatchEvent(i)}}function getAnimationElement(t,e,a,r){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"0.4s",i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"0.1s",s=t.querySelector("animate");if(s)return $.attr(s,{attributeName:e,from:a,to:r,dur:n,begin:"click + "+i}),t;var o=createSVG("animate",{attributeName:e,from:a,to:r,dur:n,begin:i,calcMode:"spline",values:a+";"+r,keyTimes:"0; 1",keySplines:cubic_bezier("ease-out")});return t.appendChild(o),t}function cubic_bezier(t){return{ease:".25 .1 .25 1",linear:"0 0 1 1","ease-in":".42 0 1 1","ease-out":"0 0 .58 1","ease-in-out":".42 0 .58 1"}[t]}SVGElement.prototype.getX=function(){return+this.getAttribute("x")},SVGElement.prototype.getY=function(){return+this.getAttribute("y")},SVGElement.prototype.getWidth=function(){return+this.getAttribute("width")},SVGElement.prototype.getHeight=function(){return+this.getAttribute("height")},SVGElement.prototype.getEndX=function(){return this.getX()+this.getWidth()};var DateScale,$={on:function(t,e,a,r){r?$.delegate(t,e,a,r):(r=a,$.bind(t,e,r))},off:function(t,e,a){t.removeEventListener(e,a)},bind:function(e,t,a){t.split(/\s+/).forEach(function(t){e.addEventListener(t,a)})},delegate:function(t,e,a,r){t.addEventListener(e,function(t){var e=t.target.closest(a);e&&(t.delegatedTarget=e,r.call(this,t,e))})},closest:function(t,e){return e?e.matches(t)?e:$.closest(t,e.parentNode):null},attr:function(t,e,a){if(!a&&"string"==typeof e)return t.getAttribute(e);if("object"!==(void 0===e?"undefined":_typeof(e)))t.setAttribute(e,a);else for(var r in e)$.attr(t,r,e[r])}};!function(t){t[t.MILLISECOND=0]="MILLISECOND",t[t.SECOND=1]="SECOND",t[t.MINUTE=2]="MINUTE",t[t.HOUR=3]="HOUR",t[t.DAY=4]="DAY",t[t.MONTH=5]="MONTH",t[t.YEAR=6]="YEAR"}(DateScale||(DateScale={}));var classNames={element:"gan2",container:"gan2-container",popupWrapper:"popup-wrapper",gridBackground:"grid-background",gridRow:"grid-row",rowLine:"row-line",gridHeader:"grid-header",tick:"tick",todayHighlight:"today-highlight",active:"active",handleGroup:"handle-group",bar:"bar",barLabel:"bar-label",progress:"progress",progressBar:"bar-progress",progressFixed:"progress-fixed",barFixed:"bar-fixed",barGroup:"bar-group",barWrapper:"bar-wrapper",handle:"handle",upperText:"upper-text",upperDivisionBar:"upper-division-bar",lowerText:"lower-text"},monthNames={en:["January","February","March","April","May","June","July","August","September","October","November","December"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},postFixes={ko:{year:"년",day:"일",hour:"시"}},DateUtil=function(){function d(){classCallCheck(this,d)}return createClass(d,null,[{key:"parse",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"-",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:/[.:]/;if(!t)return new Date;if(t instanceof Date)return t;var r=t.split(" "),n=r[0].split(e).map(function(t){return parseInt(t,10)}),i=r[1]&&r[1].split(a);n[1]=n[1]-1,i&&i.length&&(4==i.length&&(i[3]="0."+i[3],i[3]=1e3*parseFloat(i[3])),n=n.concat(i));var s=slicedToArray(n,6),o=s[0],p=s[1],h=s[2],l=s[3],u=s[4],d=s[5];return new Date(o,p,h,0|l,0|u,0|d)}},{key:"toString",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=this.getDateValues(t).map(function(t,e){return d.padStart((t=1===e?t+1:t)+"",6===e?3:2,"0")}),r=a[0]+"-"+a[1]+"-"+a[2],n=a[3]+":"+a[4]+":"+a[5]+"."+a[6];return r+(e?" "+n:"")}},{key:"format",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss.SSS",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",r=this.getDateValues(t).map(function(t){return d.padStart(t,2,0)}),n=function(t){return postFixes[a]?postFixes[a][t]:""},i={YYYY:r[0],MM:d.padStart(+r[1]+1,2,0),DD:r[2],HH:r[3],mm:r[4],ss:r[5],SSS:r[6],D:r[2],MMMM:monthNames[a][+r[1]],MMM:monthNames[a][+r[1]],DDDD:[+r[2]]+n("day"),HHHH:[+r[3]]+n("hour"),YYYYYYYY:[+r[0]+n("year")]},s=e,o=[];return Object.keys(i).sort(function(t,e){return e.length-t.length}).forEach(function(t){s.includes(t)&&(s=s.replace(t,"$"+o.length),o.push(i[t]))}),o.forEach(function(t,e){s=s.replace("$"+e,t)}),s}},{key:"diff",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:DateScale.DAY,r=[t,e].map(function(t){return d.parse(t)}).map(function(t){return t.getTime()}).sort(function(t,e){return e-t}),n=slicedToArray(r,2),i=n[0]-n[1],s=i/1e3,o=s/60,p=o/60,h=p/24,l=h/30,u=[i,s,o,p,h,l,l/12];return Math.floor(u[a])}},{key:"today",value:function(){var t=this.getDateValues().slice(0,3),e=slicedToArray(t,3),a=e[0],r=e[1],n=e[2];return new Date(a,r,n)}},{key:"now",value:function(){return new Date}},{key:"add",value:function(t,e,a){var r;return new Date(t.getFullYear()+(a===DateScale.YEAR?e:0),t.getMonth()+(a===DateScale.MONTH?e:0),t.getDate()+(r=e,a===DateScale.DAY?r:0),t.getHours()+(a===DateScale.HOUR?e:0),t.getMinutes()+(a===DateScale.MINUTE?e:0),t.getSeconds()+(a===DateScale.SECOND?e:0),t.getMilliseconds()+(a===DateScale.MILLISECOND?e:0))}},{key:"startOf",value:function(t,e){var a,r=(defineProperty(a={},DateScale.YEAR,6),defineProperty(a,DateScale.MONTH,5),defineProperty(a,DateScale.DAY,4),defineProperty(a,DateScale.HOUR,3),defineProperty(a,DateScale.MINUTE,2),defineProperty(a,DateScale.SECOND,1),defineProperty(a,DateScale.MILLISECOND,0),a),n=function(t){return r[t]<=r[e]};return new Date(t.getFullYear(),n(DateScale.YEAR)?0:t.getMonth(),n(DateScale.MONTH)?1:t.getDate(),n(DateScale.DAY)?0:t.getHours(),n(DateScale.HOUR)?0:t.getMinutes(),n(DateScale.MINUTE)?0:t.getSeconds(),n(DateScale.SECOND)?0:t.getMilliseconds())}},{key:"clone",value:function(t){return new Date(t)}},{key:"getDateValues",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Date;return[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]}},{key:"getDateLabel",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"en",r=!!postFixes[a],n="",i="",s=r?"YYYYYYYY":"YYYY",o=r?"HHHH":"HH",p=r?"DDDD":"D",h=r?"MMMM":"MMM",l=r?"MMM "+p:p+" MMM";switch(e){case DateScale.YEAR:n=d.format(t,""+s,a);break;case DateScale.MONTH:i=t.getFullYear()?d.format(t,""+s,a):"",n=d.format(t,""+h,a);break;case DateScale.HOUR:i=t.getDate()?d.format(t,""+l,a):"",n=d.format(t,""+o,a);break;default:i=t.getMonth()||0===t.getMonth()?d.format(t,"MMMM",a):"",n=d.format(t,""+p,a)}return{lower:n,upper:i}}},{key:"padStart",value:function(t,e,a){return t+="",e>>=0,a=String(void 0!==a?a:" "),t.length>e?String(t):((e-=t.length)>a.length&&(a+=a.repeat(e/a.length)),a.slice(0,e)+String(t))}}]),d}(),Gan2Arrow=function(){function r(t,e,a){classCallCheck(this,r),this.gantt=t,this.fromTask=e,this.toTask=a,this.calculatePath(),this.create()}return createClass(r,[{key:"calculatePath",value:function(){var t=this.gantt.option,e=t.arrowCurve,a=t.headerHeight,r=t.barHeight,n=t.padding,i=[this.fromTask.taskBar,this.toTask.taskBar],s=i[0],o=i[1],p=o.$bar.getX()-20;p<s.$bar.getX()+20?p=s.$bar.getX()+20:p>s.$bar.getX()+s.$bar.getWidth()-20&&(p=s.$bar.getX()+s.$bar.getWidth()-20);var h=a+r+(n+r)*this.fromTask.index+n,l=o.$bar.getX()-n/2,u=a+r/2+(n+r)*this.toTask.index+n,d=this.fromTask.index>this.toTask.index,c=d?1:0,g=d?-e:e,f=u+(d?+e:-e);if(this.path="M "+p+" "+h+"\n                 V "+f+"\n                 a "+e+" "+e+" 0 0 "+c+" "+e+" "+g+"\n                 L "+l+" "+u+"\n                 m -5 -5\n                 l 5 5\n                 l -5 5",o.$bar.getX()<=s.$bar.getX()+n){var v=n/2-e,b=o.$bar.getY()+o.height/2-g,y=o.$bar.getX()-n;this.path="M "+p+" "+h+"\n                   v "+v+"\n                   a "+e+" "+e+" 0 0 1 -"+e+" "+e+"\n                   H "+y+"\n                   a "+e+" "+e+" 0 0 "+c+" -"+e+" "+g+"\n                   V "+b+"\n                   a "+e+" "+e+" 0 0 "+c+" "+e+" "+g+"\n                   L "+l+" "+u+"\n                   m -5 -5\n                   l 5 5\n                   l -5 5"}}},{key:"create",value:function(){this.$element=createSVG("path",{d:this.path,class:this.toTask.customArrowClass,"data-from":this.fromTask.id,"data-to":this.toTask.id})}},{key:"update",value:function(){this.calculatePath(),this.$element.setAttribute("d",this.path)}}]),r}(),Gan2Task=function(){function o(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:DateScale.DAY,r=this,n=arguments[3],i=arguments[4];if(classCallCheck(this,o),this.gan2Chart=e,this._task=t,this.id=i?i.toString():o.generateId(t),this.name=t.name,this.index=e._gan2TaskIndex++,this.startDate=DateUtil.parse(t.startDate),this.endDate=DateUtil.parse(t.endDate),this.progress=t.progress,this.progressFixed=t.progressFixed,this.customArrowClass=t.customArrowClass,this.customClass=t.customClass,this.fixed=t.fixed,this.parentTask=n,this.childTask=[],this._arrows=[],t.startDate||t.endDate)this.startDate=DateUtil.parse(this.startDate)||DateUtil.add(this.endDate,-2,a),this.endDate=DateUtil.parse(this.endDate)||DateUtil.add(this.startDate,2,a);else{var s=DateUtil.today();this.startDate=s,this.endDate=DateUtil.add(s,2,a)}DateUtil.getDateValues(this.endDate).slice(3).every(function(t){return 0===t})&&(this.endDate=DateUtil.add(this.endDate,24,DateScale.HOUR)),t.childTask&&(this.childTask=t.childTask.map(function(t){return new o(e,t,a,r)}))}return createClass(o,[{key:"_drawArrow",value:function(t){var a=this;if(this._arrows=[].concat(this.childTask.reduce(function(t,e){return t.concat(e._drawArrow(a.id))},[])),t){var e=new Gan2Arrow(this.gan2Chart,this.parentTask,this);this.gan2Chart._layers.arrow.appendChild(e.$element),this._arrows.push(e)}return this._arrows}},{key:"getAllChildTaskWithThis",get:function(){return this.childTask.reduce(function(t,e){return t.concat(e.getAllChildTaskWithThis)},[]).concat(this)}},{key:"length",get:function(){return this.childTask.reduce(function(t,e){return t+1},0)+1}}],[{key:"generateId",value:function(t){return t.name+"_"+Math.random().toString(36).slice(2,12)}}]),o}(),Gan2Bar=function(){function a(t,e){classCallCheck(this,a),this.gan2Chart=t,this.task=e,this.fixed=e.fixed,this.progressfixed=e.progressFixed,this.prepareValues(),this.draw(),this.bindPopupEvent()}return createClass(a,[{key:"prepareValues",value:function(){this.duration=DateUtil.diff(this.task.endDate,this.task.startDate,this.gan2Chart._viewMode-1)/this.gan2Chart.option.step,this.width=this.gan2Chart.option.columnWidth*this.duration,this.height=this.gan2Chart.option.barHeight,this.x=this.computeX,this.y=this.computeY,this.cornerRadius=this.gan2Chart.option.barCornerRadius,this.progressWidth=this.gan2Chart.option.columnWidth*this.duration*(this.task.progress/100)||0,this.$group=createSVG("g",{class:classNames.barWrapper+" "+(this.task.customClass||""),"data-id":this.task.id}),this.$barGroup=createSVG("g",{class:""+classNames.barGroup,appendTo:this.$group}),this.$handleGroup=createSVG("g",{class:""+classNames.handleGroup,appendTo:this.$group})}},{key:"draw",value:function(){this.drawBar(),this.drawProgressBar(),this.drawLabel(),this.drawResizeHandles()}},{key:"drawBar",value:function(){this.$bar=createSVG("rect",{x:this.x,y:this.y,width:this.width,height:this.height,rx:this.cornerRadius,ry:this.cornerRadius,class:""+classNames.bar,appendTo:this.$barGroup}),animateSVG(this.$bar,"width",0,this.width),this.fixed&&this.$barGroup.classList.add(""+classNames.barFixed)}},{key:"drawProgressBar",value:function(){this.$progressBar=createSVG("rect",{x:this.x,y:this.y,width:this.progressWidth,height:this.height,rx:this.cornerRadius,ry:this.cornerRadius,class:""+classNames.progressBar,appendTo:this.$barGroup}),animateSVG(this.$progressBar,"width",0,this.progressWidth)}},{key:"drawLabel",value:function(){var t=this;createSVG("text",{x:this.x+this.width/2,y:this.y+this.height/2,innerHTML:this.task.name,class:""+classNames.barLabel,appendTo:this.$barGroup}),requestAnimationFrame(function(){return t.updateLabelPosition()})}},{key:"drawResizeHandles",value:function(){if(!this.fixed){var t=this.$bar;createSVG("rect",{x:t.getX()+t.getWidth()-9,y:t.getY()+1,width:8,height:this.height-2,rx:this.cornerRadius,ry:this.cornerRadius,class:classNames.handle+" right",appendTo:this.$handleGroup}),createSVG("rect",{x:t.getX()+1,y:t.getY()+1,width:8,height:this.height-2,rx:this.cornerRadius,ry:this.cornerRadius,class:classNames.handle+" left",appendTo:this.$handleGroup}),this.task.progress&&this.task.progress<100&&!this.progressfixed&&(this.$handleProgress=createSVG("polygon",{points:this.getProgressPolygonPoints(),class:classNames.handle+" "+classNames.progress,appendTo:this.$handleGroup}))}}},{key:"getProgressPolygonPoints",value:function(){var t=this.$progressBar;return[t.getEndX()-5,t.getY()+t.getHeight(),t.getEndX()+5,t.getY()+t.getHeight(),t.getEndX(),t.getY()+t.getHeight()-8.66].toString()}},{key:"bindPopupEvent",value:function(){var e=this,a=this.gan2Chart.option.popupTrigger;a.includes("click")&&($.on(this.$group,"mousedown",function(t){return e.gan2Chart._$popupWrapper.classList.add("block-event")}),$.on(this.$group,"mouseup",function(t){return e.gan2Chart._$popupWrapper.classList.remove("block-event")})),$.on(this.$group,"focus "+a,function(t){e.gan2Chart._draggingBar||(e.gan2Chart._draggingBar||t.type!==a||e.gan2Chart._showPopup(t,e.task),e.gan2Chart._unSelectAll(),e.$group.classList.toggle("."+classNames.active))}),a.includes("mouse")&&(this.gan2Chart._$popupWrapper.classList.add("block-event"),$.on(this.$group,"mouseleave",function(t){return e.gan2Chart._hidePopup(t)}))}},{key:"isUpdatableX",value:function(t){return!this.task.parentTask||this.task.parentTask.taskBar.$bar.getX()<=t}},{key:"updateBarPosition",value:function(t){var e=t.x,a=void 0===e?null:e,r=t.width,n=void 0===r?null:r,i=this.$bar;if(a){var s=this.task.getAllChildTaskWithThis.map(function(t){return t.taskBar.$bar.getX()}).reduce(function(t,e){return e<t?e:t});if(!this.isUpdatableX(s))return;i.setAttribute("x",(+a).toString())}n&&n>=this.gan2Chart.option.columnWidth&&i.setAttribute("width",(+n).toString()),this.updateLabelPosition(),this.updateHandlePosition(),this.$progressBar.setAttribute("x",this.$bar.getX()),this.$progressBar.setAttribute("width",this.$bar.getWidth()*(this.task.progress/100)),this.task._arrows.forEach(function(t){return t.update()})}},{key:"updateLabelPosition",value:function(){var t=this.$bar,e=this.$group.querySelector("."+classNames.barLabel);e.getBBox().width>t.getWidth()?e.setAttribute("x",t.getX()+t.getWidth()+5):e.setAttribute("x",t.getX()+t.getWidth()/2)}},{key:"dateChange",value:function(t){var e=this.computeStartEndDate(),a=slicedToArray(e,2),r=a[0],n=a[1],i=[this.task.startDate,this.task.endDate],s=i[0],o=i[1];this.task.startDate.getTime()!==r.getTime()&&(this.task.startDate=r),this.task.endDate.getTime()!==n.getTime()&&(this.task.endDate=n),this.gan2Chart._triggerEvent(t,"change",[this.task]),this.gan2Chart._triggerEvent(t,"taskChange",[this.task,s,o,r,n])}},{key:"progressChange",value:function(t){var e=this.task.progress,a=Math.floor(this.$progressBar.getWidth()/this.$bar.getWidth()*100);this.task.progress=a,this.gan2Chart._triggerEvent(t,"change",[this.task]),this.gan2Chart._triggerEvent(t,"taskProgressChange",[this.task,e,a])}},{key:"computeStartEndDate",value:function(){var t=this.$bar,e=t.getX()/this.gan2Chart.option.columnWidth,a=DateUtil.add(this.gan2Chart.startDate,e*this.gan2Chart.option.step,this.gan2Chart._viewMode-1),r=t.getWidth()/this.gan2Chart.option.columnWidth;return[a,DateUtil.add(a,r*this.gan2Chart.option.step,this.gan2Chart._viewMode-1)]}},{key:"updateHandlePosition",value:function(){var t=this.$bar,e=this.$handleGroup.querySelector("."+classNames.handle+".left");e&&e.setAttribute("x",t.getX()+1);var a=this.$handleGroup.querySelector("."+classNames.handle+".right");a&&a.setAttribute("x",t.getEndX()-9);var r=this.$handleGroup.querySelector("."+classNames.handle+"."+classNames.progress);r&&r.setAttribute("points",this.getProgressPolygonPoints())}},{key:"computeX",get:function(){var t=this.gan2Chart.option.columnWidth;return DateUtil.diff(this.gan2Chart.startDate,this.task.startDate,this.gan2Chart._viewMode)*t}},{key:"computeY",get:function(){return this.gan2Chart.option.headerHeight+this.gan2Chart.option.padding+this.task.index*(this.height+this.gan2Chart.option.padding)}}]),a}(),Gan2Popup=function(){function a(t,e){classCallCheck(this,a),this.gan2Chart=t,this.$popupWrapper=t._$popupWrapper,this.customHtmlSupplier=e||this.defaultHtmlSupplier,this.hide()}return createClass(a,[{key:"show",value:function(t,e){t&&(this.task=t),this.html=this.customHtmlSupplier(this.task),this.html+='<div class="pointer"></div>',this.$popupWrapper.innerHTML=this.html;var a=this.$popupWrapper.querySelector(".pointer");a.style.transform="rotateZ(90deg)",a.style.left="-7px",a.style.top="2px";var r=[this.task.taskBar.$bar.getX(),this.task.taskBar.$bar.getY(),this.task.taskBar.$bar.getWidth()],n=r[0],i=r[1],s=r[2];e&&e.type.includes("mouse")&&(n=e.offsetX-s+10,i=e.offsetY-5),this.$popupWrapper.style.left=n+(s+10)+"px",this.$popupWrapper.style.top=i+"px",this.$popupWrapper.style.opacity="1"}},{key:"hide",value:function(){this.$popupWrapper.style.left="0px",this.$popupWrapper.style.top="0px",this.$popupWrapper.style.opacity="0"}},{key:"defaultHtmlSupplier",value:function(t){var e=DateUtil.format(t.startDate,"YYYY-MM-DD HH:mm:ss",this.gan2Chart.option.language),a=DateUtil.format(t.endDate,"YYYY-MM-DD HH:mm:ss",this.gan2Chart.option.language);return'<div class="title">'+t.name+'</div>\n            <div class="content">\n              <div>'+e+"</div>\n              <div>~ "+a+"</div>\n            </div>"}}]),a}(),defaultOption={headerHeight:50,columnWidth:40,step:24,barHeight:20,barCornerRadius:2,arrowCurve:5,padding:18,viewMode:"Day",popupTrigger:"mousemove",popupHtmlSupplier:null,autoScroll:!0,language:"en",datePaddingQty:"auto",paddingBarCount:2},Gan2Chart=function(){function r(t,e,a){classCallCheck(this,r),this._gan2TaskIndex=0,this.chartDates=[],this.bars=[],this.isPopupOpen=!1,this.option=Object.assign({},defaultOption,a),this.constructOption=Object.assign({},this.option),this.option.startDate&&(this.startDate=DateUtil.parse(this.option.startDate)),this.option.endDate&&(this.endDate=DateUtil.parse(this.option.endDate)),this.setupWrapper(t),this.setupTasks(e),this.changeViewMode(),this.bindGridClickEvent(),this.bindBarEvent(),this.progressBarEventBind()}return createClass(r,[{key:"setupWrapper",value:function(t){var e=void 0,a=void 0;if("string"==typeof t){if(!(e=document.querySelector(t)))throw"Gan2Chart needs wrapper element"}else a=t instanceof HTMLElement?(e=t).querySelector("svg"):t;a?(this.$svg=a,this.$svg.className.add(classNames.element)):this.$svg=createSVG("svg",{appendTo:e,class:classNames.element}),this._$container=document.createElement("div"),this._$container.classList.add(classNames.container),this.$svg.parentElement.appendChild(this._$container),this._$container.appendChild(this.$svg),this._$popupWrapper=document.createElement("div"),this._$popupWrapper.classList.add(classNames.popupWrapper),this._$container.appendChild(this._$popupWrapper)}},{key:"setupTasks",value:function(t){var e=this;Array.isArray(t)?t[0]instanceof Gan2Task&&(t=this.gan2TaskToTask(t)):t=[t],this.tasks=t.map(function(t){return new Gan2Task(e,t,e._viewMode)}),this._gan2TaskLength=this.tasks.reduce(function(t,e){return t+e.length},0)+this.option.paddingBarCount}},{key:"changeViewMode",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.option.viewMode,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.option.autoScroll;this.option.viewMode=t.replace(" ","_").toUpperCase(),this.updateViewScale(),this.setupDate(),this.render(),this._hidePopup(),e&&this.setScrollPosition()}},{key:"updateViewScale",value:function(){switch(this._viewMode){case DateScale.HOUR:this.option.step=2.5*this.constructOption.step,this.option.columnWidth=this.constructOption.columnWidth;break;case DateScale.DAY:this.option.step=this.constructOption.step,this.option.columnWidth=this.constructOption.columnWidth;break;default:this.option.step=30*this.constructOption.step,this.option.columnWidth=2*this.constructOption.columnWidth}}},{key:"setupDate",value:function(){var p=this;!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:p._viewMode,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:p.option.datePaddingQty,a=function r(t,n,i){return t.forEach(function(t){if((!n||t.startDate.getTime()<n.getTime())&&(n=t.startDate),(!i||t.endDate.getTime()>i.getTime())&&(i=t.endDate),t.childTask){var e=r(t.childTask,n,i),a=slicedToArray(e,2);n=a[0],i=a[1]}}),[n,i]}(p.tasks),r=slicedToArray(a,2),n=r[0],i=r[1];if("string"==typeof e){var s=DateUtil.diff(n,i,t),o=t>=DateScale.MONTH?18:30;e=s<o?(o-s)/2:4}p.option.startDate||(p.startDate=DateUtil.add(DateUtil.startOf(n,t),-e,t));p.option.endDate||(p.endDate=DateUtil.add(DateUtil.startOf(i,t),e,t))}(),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:p._viewMode;p.chartDates.splice(0);var e=DateUtil.clone(p.startDate);p.chartDates.push(e);for(;e<p.endDate;)e=DateUtil.add(e,1,t),p.chartDates.push(e)}()}},{key:"render",value:function(){this.$svg.innerHTML="",this.bars.splice(0),this.setupLayer(),this.drawGrid(),this.drawDateAndDivideBar(),this.drawGanttBars(),this.drawArrows()}},{key:"setScrollPosition",value:function(){var t=this.$svg.parentElement;if(t){var e=this.option.datePaddingQty;"string"==typeof e&&(e=4),t.scrollLeft=e*this.option.columnWidth-this.option.columnWidth}}},{key:"drawArrows",value:function(){this.tasks.forEach(function(t){return t._drawArrow()})}},{key:"setupLayer",value:function(){var t=!0,e=!(this._layers={}),a=void 0;try{for(var r,n=["grid","date","arrow","progress","bar","details"][Symbol.iterator]();!(t=(r=n.next()).done);t=!0){var i=r.value;this._layers[i]=createSVG("g",{class:i,appendTo:this.$svg})}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}}},{key:"drawGanttBars",value:function(){var e=this;this.tasks.forEach(function(t){return function e(a,t){t.childTask&&t.childTask.forEach(function(t){return e(a,t)});var r=new Gan2Bar(a,t);t.taskBar=r,a._layers.bar.appendChild(r.$group),a.bars.push(r)}(e,t)})}},{key:"drawGrid",value:function(){var t,e,o=this;o.gridWidth=o.chartDates.length*o.option.columnWidth,o.gridHeight=o.option.headerHeight+o.option.padding+(o.option.barHeight+o.option.padding)*o._gan2TaskLength,createSVG("rect",{x:0,y:0,width:o.gridWidth,height:o.gridHeight,class:classNames.gridBackground,appendTo:o._layers.grid}),$.attr(o.$svg,{height:o.gridHeight,width:o.gridWidth}),function(){for(var t=createSVG("g",{appendTo:o._layers.grid}),e=createSVG("g",{appendTo:o._layers.grid}),a=o.chartDates.length*o.option.columnWidth,r=o.option.barHeight+o.option.padding,n=o.option.headerHeight+o.option.padding/2,i=0,s=o._gan2TaskLength;i<s;i++)createSVG("rect",{x:0,y:n,width:a,height:r,class:classNames.gridRow,appendTo:t}),createSVG("line",{x1:0,y1:n+r,x2:a,y2:n+r,class:classNames.rowLine,appendTo:e}),n+=o.option.barHeight+o.option.padding}(),createSVG("rect",{x:0,y:0,width:o.chartDates.length*o.option.columnWidth,height:o.option.headerHeight+10,class:classNames.gridHeader,appendTo:o._layers.grid}),function(){for(var t=o.option.columnWidth,e=o.option.headerHeight+o.option.padding/2,a=(o.option.barHeight+o.option.padding)*o._gan2TaskLength,r=0,n=o.chartDates.length;r<n;r++)createSVG("path",{d:"M "+t*r+" "+e+" v "+a,class:classNames.tick,appendTo:o._layers.grid})}(),t=DateUtil.now(),e=o._viewMode,t<o.chartDates[0]||o.chartDates[o.chartDates.length-1]<t||createSVG("rect",{x:DateUtil.diff(t,o.chartDates[0],e)*o.option.columnWidth,y:0,width:o.option.columnWidth,height:(o.option.barHeight+o.option.padding)*o._gan2TaskLength+o.option.headerHeight+o.option.padding/2,class:classNames.todayHighlight,appendTo:o._layers.grid})}},{key:"drawDateAndDivideBar",value:function(){for(var a,t=(a=this).chartDates.map(function(t,e){return a.getDateLabel(t,e)}),e=t[0],r=0,n=t.length-1;r<=n;r++){var i=t[r];if(createSVG("text",{x:i.lowerX,y:i.lowerY,innerHTML:i.lowerText,class:classNames.lowerText,appendTo:this._layers.date}),r===n||e.upperText!=i.upperText){var s=r===n?this.option.columnWidth/2:0,o=createSVG("text",{x:(e.upperX+i.upperX)/2+s,y:e.upperY,innerHTML:e.upperText,class:classNames.upperText,appendTo:this._layers.date});if(o.getBBox().x>this._layers.grid.getBBox().width&&o.remove(),e.upperText===i.upperText)return;createSVG("line",{x1:i.lowerX-this.option.columnWidth/2,y1:0,x2:i.lowerX-this.option.columnWidth/2,y2:this.gridHeight,class:classNames.upperDivisionBar,appendTo:this._layers.grid}),e=i}}}},{key:"getDateLabel",value:function(t,e){var a=DateUtil.getDateLabel(t,this._viewMode,this.option.language),r=a.lower,n=a.upper,i={x:e*this.option.columnWidth,lowerY:this.option.headerHeight,upperY:this.option.headerHeight-25};return{upperText:n,lowerText:r,upperX:i.x,upperY:i.upperY,lowerX:i.x+this.option.columnWidth/2,lowerY:n?i.lowerY:(i.upperY+i.lowerY)/2}}},{key:"bindGridClickEvent",value:function(){var e=this;$.on(this.$svg,this.option.popupTrigger,"."+classNames.gridRow+", ."+classNames.gridHeader,function(t){e._unSelectAll(),e._hidePopup(t)})}},{key:"bindBarEvent",value:function(){var i=this,s=0,o=!1,p=!1,h=!1,l=[],u=null;$.on(this.$svg,"mousedown","."+classNames.barWrapper+", ."+classNames.handle,function(t,e){var a=$.closest("."+classNames.barWrapper,e);if(a.classList.add(classNames.active),!(!(u=i._getBar(a.getAttribute("data-id")))||u&&u.fixed)){var r=e.classList;r.contains("left")?p=!0:r.contains("right")?h=!0:r.contains(""+classNames.barWrapper)&&(o=!0),s=t.offsetX,t.offsetY,(l=u.task.getAllChildTaskWithThis.map(function(t){return t.taskBar})).forEach(function(t){var e=t.$bar;e.ox=e.getX(),e.oy=e.getY(),e.owidth=e.getWidth(),e.finaldx=0})}}),$.on(this.$svg,"mousemove",function(t){if(o||p||h){var r=t.offsetX-s,n=u;l.forEach(function(t){var e=t.$bar;if(e.finaldx=i.getSnapPosition(r),p)n===t?t.updateBarPosition({x:e.ox+e.finaldx,width:e.owidth-e.finaldx}):t.updateBarPosition({x:e.ox+e.finaldx});else if(h)t.updateBarPosition({width:e.owidth+e.finaldx});else if(o){var a=e.ox+e.finaldx;t.isUpdatableX(a)&&t.updateBarPosition({x:a})}}),r!==u.$bar.finaldx&&(i._draggingBar=n),u.dateChange(t),i._redrawPopup()}}),$.on(this.$svg,"mouseup",function(e){l.forEach(function(t){t.$bar.finaldx&&t.dateChange(e)}),i._draggingBar||e.target.parentElement.classList.contains(""+classNames.barGroup)&&i._triggerEvent(e,"taskClick",[u.task])}),this._$container.addEventListener("mouseup",function(t){(o||p||h)&&l.forEach(function(t){return t.$group.classList.remove(""+classNames.active)}),h=p=o=!1;var e=i;e._draggingBar&&(i.setupDate(),i.render(),setTimeout(function(){return e._draggingBar=null},10))})}},{key:"progressBarEventBind",value:function(){var r=this,n=0,i=null,s=null,o=null,p=null;$.on(this.$svg,"mousedown","."+classNames.handle+"."+classNames.progress,function(t,e){i=!0,n=t.offsetX;var a=$.closest("."+classNames.barWrapper,e);s=r._getBar(a.getAttribute("data-id")),o=s.$bar,(p=s.$progressBar).finaldx=0,p.owidth=p.getWidth(),p.minDx=-p.getWidth(),p.maxDx=o.getWidth()-p.getWidth()}),$.on(this.$svg,"mousemove",function(t){if(i){var e=t.offsetX-n;e>p.maxDx&&(e=p.maxDx),e<p.minDx&&(e=p.minDx);var a=s.$handleProgress;$.attr(p,"width",p.owidth+e),$.attr(a,"points",s.getProgressPolygonPoints()),p.finaldx=e,s.progressChange(t),r._redrawPopup()}}),$.on(this.$svg,"mouseup",function(t){i=!1,p&&p.finaldx&&(s.progressChange(t),r._unSelectAll())})}},{key:"_redrawPopup",value:function(){this.isPopupOpen&&this._showPopup()}},{key:"_showPopup",value:function(t,e){this.popup||(this.popup=new Gan2Popup(this,this.option.popupHtmlSupplier)),this.isPopupOpen||this._triggerEvent(t,"popupOpen",[e]),this.isPopupOpen=!0,this.popup.show(e,t)}},{key:"_hidePopup",value:function(t){this.popup&&(this.isPopupOpen&&this._triggerEvent(t,"popupClose",[]),this.isPopupOpen=!1,this.popup.hide())}},{key:"_getBar",value:function(e){return this.bars.find(function(t){return t.task.id===e})}},{key:"getSnapPosition",value:function(t){var e=t,a=void 0;return this._viewMode===DateScale.MONTH?e-(a=t%(this.option.columnWidth/30))+(a<this.option.columnWidth/60?0:this.option.columnWidth/30):e-(a=t%this.option.columnWidth)+(a<this.option.columnWidth/2?0:this.option.columnWidth)}},{key:"gan2TaskToTask",value:function(t){var a=this;return t.map(function(t){var e=t._task;return e.childTask=a.gan2TaskToTask(t.childTask),e})}},{key:"_unSelectAll",value:function(){this.$svg.querySelectorAll(".bar ."+classNames.barWrapper).forEach(function(t){return t.classList.remove(classNames.active)})}},{key:"_triggerEvent",value:function(t,e,a){var r,n=Object.keys(this.option).find(function(t){return t.toUpperCase()==="ON"+e.toUpperCase()});this.option[n]&&(r=this.option)[n].apply(r,[t].concat(toConsumableArray(a)))}},{key:"refresh",value:function(t){t&&this.setupTasks(t),this.changeViewMode()}},{key:"_viewMode",get:function(){var t=DateScale[this.option.viewMode.replace(" ","_").toUpperCase()];return t||DateScale.DAY}}]),r}();module.exports=Gan2Chart;
